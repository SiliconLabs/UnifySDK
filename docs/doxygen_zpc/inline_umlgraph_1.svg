<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="913px" preserveAspectRatio="none" style="width:1344px;height:913px;background:#FFFFFF;" version="1.1" viewBox="0 0 1344 913" width="1344px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rz4bpc8vzvcg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;" x1="167" x2="167" y1="40.7999" y2="387.2"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="167" x2="167" y1="387.2" y2="428.3999"/><line style="stroke:#A80036;stroke-width:1.0;" x1="167" x2="167" y1="428.3999" y2="719.6001"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="167" x2="167" y1="719.6001" y2="760.8"/><line style="stroke:#A80036;stroke-width:1.0;" x1="167" x2="167" y1="760.8" y2="869.6"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728" x2="728" y1="40.7999" y2="387.2"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="728" x2="728" y1="387.2" y2="428.3999"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728" x2="728" y1="428.3999" y2="719.6001"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="728" x2="728" y1="719.6001" y2="760.8"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728" x2="728" y1="760.8" y2="869.6"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1251" x2="1251" y1="40.7999" y2="387.2"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1251" x2="1251" y1="387.2" y2="428.3999"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1251" x2="1251" y1="428.3999" y2="719.6001"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1251" x2="1251" y1="719.6001" y2="760.8"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1251" x2="1251" y1="760.8" y2="869.6"/><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="55" x="138" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="145" y="25.0059">MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="55" x="138" y="868.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="145" y="888.606">MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="103" x="675" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="682" y="25.0059">DotDot MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="103" x="675" y="868.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="682" y="888.606">DotDot MQTT</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="105" x="1197" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="1204" y="25.0059">OnOff Mapper</text><rect fill="#FEFECE" filter="url(#f1rz4bpc8vzvcg)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="105" x="1197" y="868.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="1204" y="888.606">OnOff Mapper</text><path d="M128,55.7999 L128,111.7999 L1291,111.7999 L1291,65.7999 L1281,55.7999 L128,55.7999 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1281,55.7999 L1281,65.7999 L1291,65.7999 L1281,55.7999 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="416.5" y="72.8769">In this example only OnOff mappers are shown.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="416.5" y="88.477">But there should exist mappers for all supported ZCL Clusters.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="573" x="416.5" y="104.077">In addition only a selection of the supported commands for each of these mappers are shown here.</text><rect fill="#EEEEEE" filter="url(#f1rz4bpc8vzvcg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1337" x="0" y="144.7999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1337" y1="144.7999" y2="144.7999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1337" y1="147.7999" y2="147.7999"/><rect fill="#EEEEEE" filter="url(#f1rz4bpc8vzvcg)" height="28.4" style="stroke:#000000;stroke-width:2.0;" width="113" x="612" y="131.6"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="99" x="618" y="151.3929">Initialization</text><polygon fill="#A80036" points="739.5,187.5999,729.5,191.5999,739.5,195.5999,735.5,191.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="1250.5" y1="191.5999" y2="191.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="745.5" y="186.0769">uic_mqtt_dotdot_on_off_on_callback_set(on_cb)</text><polygon fill="#A80036" points="739.5,217.1999,729.5,221.1999,739.5,225.1999,735.5,221.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="1250.5" y1="221.1999" y2="221.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="745.5" y="215.6769">uic_mqtt_dotdot_on_off_off_callback_set(off_cb)</text><polygon fill="#A80036" points="739.5,246.8,729.5,250.8,739.5,254.8,735.5,250.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="1250.5" y1="250.8" y2="250.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="745.5" y="245.277">uic_mqtt_dotdot_set_on_off_write_attributes_callback(on_att_cb)</text><path d="M627,263.8 L627,288.8 L825,288.8 L825,273.8 L815,263.8 L627,263.8 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M815,263.8 L815,273.8 L825,273.8 L815,263.8 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="633" y="280.877">uic_mqtt_dotdot_init() is called</text><polygon fill="#A80036" points="178.5,316,168.5,320,178.5,324,174.5,320" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172.5" x2="727.5" y1="320" y2="320"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="184.5" y="314.477">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/On", ...);</text><polygon fill="#A80036" points="178.5,345.6,168.5,349.6,178.5,353.6,174.5,349.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172.5" x2="727.5" y1="349.6" y2="349.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="184.5" y="344.077">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/Off", ...);</text><polygon fill="#A80036" points="178.5,375.2,168.5,379.2,178.5,383.2,174.5,379.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172.5" x2="727.5" y1="379.2" y2="379.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="437" x="184.5" y="373.677">uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/WriteAttributes", ...)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="711" y="411.4189"/><path d="M1171,433.3999 L1171,458.3999 L1328,458.3999 L1328,443.3999 L1318,433.3999 L1171,433.3999 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1318,433.3999 L1318,443.3999 L1328,443.3999 L1318,433.3999 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="1177" y="450.4769">An end device is added</text><polygon fill="#A80036" points="739.5,485.5999,729.5,489.5999,739.5,493.5999,735.5,489.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="1250.5" y1="489.5999" y2="489.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="745.5" y="484.0769">uic_mqtt_dotdot_publish_supported_commands(unid, endpoint)</text><polygon fill="#A80036" points="1239.5,515.2,1249.5,519.2,1239.5,523.2,1243.5,519.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728.5" x2="1245.5" y1="519.2" y2="519.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="498" x="735.5" y="513.677">on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)</text><polygon fill="#A80036" points="1239.5,544.8,1249.5,548.8,1239.5,552.8,1243.5,548.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728.5" x2="1245.5" y1="548.8" y2="548.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="499" x="735.5" y="543.277">off_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)</text><path d="M677,561.8 L677,680.8 L1303,680.8 L1303,571.8 L1293,561.8 L677,561.8 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1293,561.8 L1293,571.8 L1303,571.8 L1293,561.8 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="753.5" y="578.877">When uic_mqtt_dotdot_publish_supported_commands is called,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="399" x="753.5" y="594.477">DotDot MQTT calls all registered OnOff command callback functions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="753.5" y="610.077">with UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="753.5" y="625.677">When the Command is supported by the unid/endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="753.5" y="641.277">SL_STATUS_OK shall be returned, otherwise SL_STATUS_NOT_AVAILABLE.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="757.5" y="656.8771"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="753.5" y="672.4771">In this example both callbacks returns SL_STATUS_OK</text><polygon fill="#A80036" points="178.5,707.6001,168.5,711.6001,178.5,715.6001,174.5,711.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172.5" x2="727.5" y1="711.6001" y2="711.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="537" x="184.5" y="706.0771">uic_mqtt_publish("ucl/by-unid/&lt;unid&gt;/ep&lt;x&gt;/OnOff/SupportedCommands", "[\"On\", \"Off\"]")</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="711" y="743.819"/><path d="M5,765.8 L5,790.8 L326,790.8 L326,775.8 L316,765.8 L5,765.8 " fill="#FBFB77" filter="url(#f1rz4bpc8vzvcg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M316,765.8 L316,775.8 L326,775.8 L316,765.8 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="11" y="782.877">IoT Service has published an OnOff/Commands/Off</text><polygon fill="#A80036" points="716.5,818,726.5,822,716.5,826,720.5,822" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="167.5" x2="722.5" y1="822" y2="822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="174.5" y="816.477">uic_mqtt_dotdot_on_on_off_off(topic, message)</text><polygon fill="#A80036" points="1239.5,847.6,1249.5,851.6,1239.5,855.6,1243.5,851.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728.5" x2="1245.5" y1="851.6" y2="851.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="438" x="735.5" y="846.077">on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_NORMAL)</text><!--MD5=[fa990df7f086d7a21d10d6ae2373599b]
@startuml inline_umlgraph_1.svg
participant "MQTT" as mqtt
participant "DotDot MQTT" as dotdot
participant "OnOff Mapper" as onoff

note over mqtt, onoff
In this example only OnOff mappers are shown.
But there should exist mappers for all supported ZCL Clusters.
In addition only a selection of the supported commands for each of these mappers are shown here.
end note
=== Initialization ==
onoff    -> dotdot: uic_mqtt_dotdot_on_off_on_callback_set(on_cb)
onoff    -> dotdot: uic_mqtt_dotdot_on_off_off_callback_set(off_cb)
onoff    -> dotdot: uic_mqtt_dotdot_set_on_off_write_attributes_callback(on_att_cb)

note over dotdot: uic_mqtt_dotdot_init() is called

dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/On", ...);
dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/Off", ...);
dotdot -> mqtt:     uic_mqtt_subscribe("ucl/by-unid/+/+/OnOff/Commands/WriteAttributes", ...)
... ...
note over onoff: An end device is added
onoff -> dotdot:    uic_mqtt_dotdot_publish_supported_commands(unid, endpoint)
dotdot -> onoff:    on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)
dotdot -> onoff:    off_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK)

note over dotdot, onoff
When uic_mqtt_dotdot_publish_supported_commands is called,
DotDot MQTT calls all registered OnOff command callback functions
with UIC_MQTT_DOTDOT_CALLBACK_TYPE_SUPPORT_CHECK.
When the Command is supported by the unid/endpoint
SL_STATUS_OK shall be returned, otherwise SL_STATUS_NOT_AVAILABLE.

In this example both callbacks returns SL_STATUS_OK
end note

dotdot -> mqtt:     uic_mqtt_publish("ucl/by-unid/<unid>/ep<x>/OnOff/SupportedCommands", "[\"On\", \"Off\"]")
... ...
note over mqtt: IoT Service has published an OnOff/Commands/Off
mqtt -> dotdot:     uic_mqtt_dotdot_on_on_off_off(topic, message)
dotdot -> onoff:    on_cb(unid, endpoint, UIC_MQTT_DOTDOT_CALLBACK_TYPE_NORMAL)
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>