<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unify SDK User guide &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/doc/unify_readme_user.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/charenc.js"></script>
        <script src="../_static/js/crypt.js"></script>
        <script src="../_static/js/sha1.js"></script>
        <script src="../_static/js/html5-qrcode.min.js"></script>
        <script src="../_static/js/qr_code_scanner.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Unify Framework Getting Started" href="getting_started_unify_sdk.html" />
    <link rel="prev" title="Running Unify on Raspberry Pi" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="introduction.html" class="icon icon-home"> Unify
            <img src="../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.7.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Unify Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="getting_started_unify.html">Getting Started with Unify</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="portable_runtime/readme_user.html">Getting Started with Unify using Portable runtime</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="getting_started.html">Running Unify on Raspberry Pi</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Unify SDK User guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started_unify_sdk.html">Getting Started with the Unify Framework</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="UnifySDK.html">Unify Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="unify_framework_services.html">Framework Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protocol_controllers.html">Protocol Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="unify_iot_services.html">IoT Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started_as_developer.html">Getting Started as a Developer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="unify_specifications/index.html">Unify Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="standards/known-abbreviations.html">Known Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="unify-sdk-user-guide">
<h1>Unify SDK User guide<a class="headerlink" href="#unify-sdk-user-guide" title="Permalink to this heading"></a></h1>
<p>This guide contains information which is common to all Unify applications.
For a having a general setup running, it assumes you have gone over the <a class="reference internal" href="getting_started_unify.html"><span class="doc std std-doc">Getting Started guide</span></a>.
Details about each application can be found in the application specific user guides.</p>
<section id="running-using-systemd">
<h2>Running Using Systemd<a class="headerlink" href="#running-using-systemd" title="Permalink to this heading"></a></h2>
<p>Normally, the Unify components should be run as a service. When the Debian packages
are installed they automatically enables themselves as systemd services.</p>
<p>the components can be started and stopped using the <code class="docutils literal notranslate"><span class="pre">systemctl</span></code> command (see systemctl
linux manual for details).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>uic-&lt;component-name&gt;
sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>uic-&lt;component-name&gt;
</pre></div>
</div>
<p>To see the logs of the components when it runs as a service, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>journalctl<span class="w"> </span>-u<span class="w"> </span>uic-&lt;component-name&gt;.service
</pre></div>
</div>
</section>
<section id="configuring-unify-components">
<h2>Configuring Unify Components<a class="headerlink" href="#configuring-unify-components" title="Permalink to this heading"></a></h2>
<p>Configuration parameters for the unify components can be specified in two
different ways.</p>
</section>
<section id="configuring-logging">
<h2>Configuring logging<a class="headerlink" href="#configuring-logging" title="Permalink to this heading"></a></h2>
<p>The logging of each unify component can be controlled by the two common
configuration parameters, <strong>log.level</strong> and <strong>log.tag_level</strong>-</p>
<p>When a component starts, the log is printed to stdout, as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+<span class="w"> </span><span class="m">2020</span>-11-11<span class="w"> </span><span class="m">14</span>:18:52:276827<span class="w"> </span>&lt;d&gt;<span class="w"> </span><span class="o">[</span>sl_log<span class="o">]</span><span class="w"> </span>Setting<span class="w"> </span>log<span class="w"> </span>level<span class="w"> </span>to<span class="w"> </span>debug
+<span class="w"> </span><span class="m">2020</span>-11-11<span class="w"> </span><span class="m">14</span>:18:52:277573<span class="w"> </span>&lt;d&gt;<span class="w"> </span><span class="o">[</span>uic_component_fixtures<span class="o">]</span><span class="w"> </span>Completed:<span class="w"> </span>UIC<span class="w"> </span>Signal<span class="w"> </span>Handler
+<span class="w"> </span><span class="m">2020</span>-11-11<span class="w"> </span><span class="m">14</span>:18:52:277631<span class="w"> </span>&lt;d&gt;<span class="w"> </span><span class="o">[</span>mqtt_client<span class="o">]</span><span class="w"> </span>Constructing<span class="w"> </span>new<span class="w"> </span>mqtt_client<span class="w"> </span>instance.
+<span class="w"> </span><span class="m">2020</span>-11-11<span class="w"> </span><span class="m">14</span>:18:52:277696<span class="w"> </span>&lt;d&gt;<span class="w"> </span><span class="o">[</span>mqtt_wrapper_mosquitto<span class="o">]</span><span class="w"> </span>Initializing<span class="w"> </span>Mosquitto<span class="w"> </span>library.
</pre></div>
</div>
<p>The general log format is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;timestamp&gt;<span class="w"> </span>&lt;severity&gt;<span class="w"> </span><span class="o">[</span>tag<span class="o">]</span><span class="w"> </span>&lt;message&gt;
</pre></div>
</div>
<p>The log level can be set globally and per tag.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eed<span class="w"> </span>--eed.datastore_file<span class="w"> </span>./eed.db<span class="w">  </span>--log.level<span class="w"> </span>i<span class="w"> </span>--log.tag_level<span class="w"> </span>uic_component_fixtures:d,mqtt_client:d
</pre></div>
</div>
<p>This will set the global log level to info but it enables the debug on the two
components such as the following: mqtt_client and uic_component_fixtures.</p>
<section id="how-to-configure-logs-rotation">
<h3>How to configure logs rotation<a class="headerlink" href="#how-to-configure-logs-rotation" title="Permalink to this heading"></a></h3>
<p>The Unify services logs ends two places. First the journald system daemon
services the logs. In addition the logs are also dumped in the
<code class="docutils literal notranslate"><span class="pre">/var/log/syslog.log</span></code>. Journald will automatically rotate logs and not
overload the system with logs.</p>
<section id="configure-journalctl">
<h4>Configure Journalctl<a class="headerlink" href="#configure-journalctl" title="Permalink to this heading"></a></h4>
<p>Unify uses systemd-journald system for logging. It should be configured with <code class="docutils literal notranslate"><span class="pre">/etc/systemd/journald.conf</span></code> file.
This file contains several parameters, but we only need a few. For detailed description, please follow <a class="reference external" href="https://man7.org/linux/man-pages/man5/journald.conf.5.html">man journald.conf(5)</a>.
Also, you should know there are two logs storages in Linux: <strong>persistent</strong> and <strong>volatile</strong>. Settings for each of them are configured separately.
Parameters, started with <code class="docutils literal notranslate"><span class="pre">System</span></code> applies to persistent storage, located in <code class="docutils literal notranslate"><span class="pre">/var/log/</span></code>.
Parameters, started with <code class="docutils literal notranslate"><span class="pre">Runtime</span></code> applies to volatile storage, located in <code class="docutils literal notranslate"><span class="pre">/run/log/journal</span></code>.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SystemMaxUse, RuntimeMaxUse</p></td>
<td><p>how much disk space the journal may use up at most</p></td>
</tr>
<tr class="row-odd"><td><p>SystemKeepFree, RuntimeKeepFree</p></td>
<td><p>how much disk space journald shall leave free for other uses</p></td>
</tr>
<tr class="row-even"><td><p>SystemMaxFileSize, RuntimeMaxFileSize</p></td>
<td><p>how large individual journal files may grow at most</p></td>
</tr>
<tr class="row-odd"><td><p>SystemMaxFiles, RuntimeMaxFiles</p></td>
<td><p>how many individual journal files to keep at most</p></td>
</tr>
<tr class="row-even"><td><p>MaxFileSec</p></td>
<td><p>the maximum time to store entries in a single journal file before rotating to the next one</p></td>
</tr>
<tr class="row-odd"><td><p>MaxRetentionSec</p></td>
<td><p>the maximum time to store journal files before deletion even if there is enough free space</p></td>
</tr>
</tbody>
</table>
<p>For disk space parameters (<code class="docutils literal notranslate"><span class="pre">SystemMaxUse</span></code>, <code class="docutils literal notranslate"><span class="pre">SystemKeepFree</span></code>, <code class="docutils literal notranslate"><span class="pre">SystemMaxFileSize</span></code>) specify values in bytes or use <em>K, M, G, T, P, E</em> as multipliers.</p>
<p>For time parameters (<code class="docutils literal notranslate"><span class="pre">MaxFileSec</span></code>, <code class="docutils literal notranslate"><span class="pre">MaxRetentionSec</span></code>) specify values in seconds or use <em>“year”, “month”, “week”, “day”, “h”</em> or <em>“m”</em> as multipliers.
Set the parameter value to <code class="docutils literal notranslate"><span class="pre">0</span></code> to turn off this feature.</p>
</section>
<section id="configure-log-rotation-syslog">
<h4>Configure log rotation syslog<a class="headerlink" href="#configure-log-rotation-syslog" title="Permalink to this heading"></a></h4>
<p>If you have enabled debug logging of the Unify SDK packages. Chances are you
will load up some big log files in syslog quite fast. To mitigate this you
can change the log rotation in the syslog log rotation file
<code class="docutils literal notranslate"><span class="pre">/etc/logrotate.d/rsyslog</span></code>. Documentation on log rotation settings can be
found <a class="reference external" href="https://manpages.debian.org/stretch/logrotate/logrotate.8.en.html">here</a>.</p>
</section>
</section>
</section>
<section id="setting-up-mosquitto">
<h2>Setting up Mosquitto<a class="headerlink" href="#setting-up-mosquitto" title="Permalink to this heading"></a></h2>
<p>The Unify framework need to the mosquitto MQTT broker to work. For this reason
mosquitto is a dependency of all the provided Debian packages. The Unify
framework works with the default mosquitto installation but it may be
desireable to change the mosquito broker installation, eg. to enable TLS
support.</p>
<p>Configure the Mosquitto broker with the following parameters to enable
TLS support. Mosquitto can support TLS and non-TLS communication simultaneously
on two different ports. For example, in the following mosquitto.conf, Mosquitto Broker
will accept non-TLS communication on port 1883.</p>
<section id="mosquitto-conf">
<h3>mosquitto.conf<a class="headerlink" href="#mosquitto-conf" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>listener<span class="w"> </span><span class="m">1883</span>
allow_anonymous<span class="w"> </span><span class="nb">true</span>

listener<span class="w"> </span><span class="m">8883</span>
cafile<span class="w"> </span>ca/ca.crt
certfile<span class="w"> </span>broker/broker.crt
keyfile<span class="w"> </span>broker/broker.key
require_certificate<span class="w"> </span><span class="nb">true</span>
</pre></div>
</div>
<p>Having the config options: <code class="docutils literal notranslate"><span class="pre">&quot;cafile&quot;</span> <span class="pre">(client/ca.crt)</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;certfile&quot;</span> <span class="pre">(broker/broker.crt)</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;keyfile&quot;</span> <span class="pre">(broker/broker.key)</span></code> in Mosquitto Broker
config file will make the Mosquitto Broker communicate with Unify components with TLS encryption.</p>
<p>For the purpose of testing a script <code class="docutils literal notranslate"><span class="pre">tls-certificates-generation.sh</span></code> has been
provided to create test certificates, for a TLS connection between the Unify components and Mosquitto Broker.</p>
<blockquote>
<div><p>WARNING: Don’t use this this script in making production certificates</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scripts/tls-certificates-generation.sh<span class="w"> </span>&lt;broker<span class="w"> </span>IP/hostname&gt;
</pre></div>
</div>
<p><em>localhost</em> may be provided when the MQTT broker and Unify Components are running on the same machine. The script will output the following files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tree<span class="w"> </span>.
<span class="p">|</span><span class="w"> </span>broker
<span class="w">   </span><span class="p">|</span><span class="w"> </span>broker.crt
<span class="w">   </span><span class="p">|</span><span class="w"> </span>broker.key
<span class="p">|</span><span class="w"> </span>ca
<span class="w">   </span><span class="p">|</span><span class="w"> </span>ca.crt
<span class="w">   </span><span class="p">|</span><span class="w"> </span>ca.key
<span class="w">   </span><span class="p">|</span><span class="w"> </span>ca.srl
<span class="p">|</span><span class="w"> </span>client
<span class="w">    </span><span class="p">|</span><span class="w"> </span>client.crt
<span class="w">    </span><span class="p">|</span><span class="w"> </span>client.key
</pre></div>
</div>
<p>Each Unify component must use the <em>mqtt.cafile</em>, <em>mqtt.certfile</em> and <em>mqtt.keyfile</em> options
to enable the TLS encrypted connection. The option can be provided from command line or from the
config file of the components.</p>
<blockquote>
<div><p>NOTE: the DevUI will need the certificates as input from the user interface itself.</p>
</div></blockquote>
</section>
<section id="using-mqtt-explorer-to-monitor-messages">
<h3>Using MQTT Explorer to Monitor Messages<a class="headerlink" href="#using-mqtt-explorer-to-monitor-messages" title="Permalink to this heading"></a></h3>
<p>You can publish MQTT message and observe the MQTT messages stored in the broker
with a <a class="reference external" href="https://mqtt-explorer.com/">MQTT Explorer</a>.
<a class="reference external" href="https://mqtt-explorer.com/">MQTT Explorer</a> is an MQTT client that provides a
structured overview of your MQTT topics.</p>
<p>Configure <a class="reference external" href="https://mqtt-explorer.com/">MQTT Explorer</a> to connect to the host
where your MQTT broker is located and the topics can be observed. Use the
<a class="reference internal" href="unify_specifications/index.html"><span class="doc std std-doc">Unify Specifications</span></a>
if you need assistance to understand what topics and they data represent.</p>
</section>
</section>
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this heading"></a></h2>
<p>Once all Unify Application components are installed and configured, one can
evaluate the system via running IoT service such as Unify dev_gui.</p>
<p>The Unify dev_gui can be accessed from a browser on
<a class="reference external" href="http://raspberrypi.local:3080">http://raspberrypi.local:3080</a>.</p>
<p><em>Note</em> that the Unify user interface needs TCP access to the port 3080 and 1337
on the Raspberry Pi.</p>
<p>See the <a class="reference internal" href="../applications/dev_ui/dev_gui/readme_user.html"><span class="doc std std-doc">Dev-GUI manual</span></a> for more
information about using this interface.</p>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2023 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>