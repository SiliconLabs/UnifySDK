<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Unify Service Discovery" name="description" />
<meta content="Service, Discovery" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. Service Discovery &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/doc/unify_specifications/Chapter06-service-discovery.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/charenc.js"></script>
        <script src="../../_static/js/crypt.js"></script>
        <script src="../../_static/js/sha1.js"></script>
        <script src="../../_static/js/html5-qrcode.min.js"></script>
        <script src="../../_static/js/qr_code_scanner.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7. The Dotdot Scenes Cluster (0x0005) in the Unify Framework" href="Chapter07-scenes.html" />
    <link rel="prev" title="5. Common OTA FW Update Service" href="Chapter05-common-ota.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../introduction.html" class="icon icon-home"> Unify
            <img src="../../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Unify Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_unify.html">Running Unify on Raspberry Pi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UnifySDK.html">Unify Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unify_framework_services.html">Framework Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../protocol_controllers.html">Protocol Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unify_iot_services.html">IoT Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_as_developer.html">Getting Started as a Developer</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Unify Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Chapter01-architecture-overview.html">1. Unify Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter02-ZCL-in-uic.html">2. Dotdot ZCL in Unify Framework for Application Level Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter03-network-management.html">3. Network Management Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter04-scenario-mappings.html">4. Scenario mapping to specific PHYs: Z-Wave, BLE and ZigBee</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter05-common-ota.html">5. Common OTA FW Update Service</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. Service Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter07-scenes.html">7. Scene Cluster and the Scene Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter08-binding.html">8. Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter09-descriptor-cluster.html">9. Descriptor Cluster ( Experimental )</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter10-aox-application.html">10. AoX Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter11-name-and-location-service.html">11. Name and Location Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter12-unify-applications-monitoring.html">12. Unify Applications Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter13-system-metrics.html">13. System Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Chapter14-unify-controller-language-data-model.html">14. Unify Controller Language Data Model ( Experimental )</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standards/known-abbreviations.html">Known Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="service-discovery">
<span id="unify-specifications-chapter-service-discovery"></span><h1><span class="section-number">6. </span>Service Discovery<a class="headerlink" href="#service-discovery" title="Permalink to this heading"></a></h1>
<section id="concept">
<h2><span class="section-number">6.1. </span>Concept<a class="headerlink" href="#concept" title="Permalink to this heading"></a></h2>
<p>All MQTT Clients (possibly including Protocol Controllers) must be able to
find out the existing devices and their capabilities to provide functionalities.
Using MQTT subscriptions as a service discovery, each client can receive
information about what they are interested in given that they have a
starting point.</p>
<section id="mqtt-topics">
<h3><span class="section-number">6.1.1. </span>MQTT Topics<a class="headerlink" href="#mqtt-topics" title="Permalink to this heading"></a></h3>
<p>Some high-level functionalities will be expected to be present at the MQTT
broker from the beginning, as follows:</p>
<ul class="simple">
<li><p>ucl/by-unid/#</p></li>
<li><p>ucl/by-group/#</p></li>
</ul>
<p>More than this can be appended to the initial list in future versions.
An MQTT client MAY subscribe to the ‘ucl/#’ topic filter and get all published
messages by the MQTT broker. However, this is not optimal from a traffic
point of view. MQTT Clients SHOULD subscribe to the minimum they need, while
still ensuring that they do not miss anything.</p>
<p>The minimum requirement to discover nodes and their capabilities is a single
subscription to <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/#</span></code>. If the resources are available, the
discovery will happen via the publication of new MQTT messages, which will show
that devices have been added to the network and their associated capabilities.</p>
</section>
<section id="discovery-of-the-protocol-controllers">
<h3><span class="section-number">6.1.2. </span>Discovery of the Protocol Controllers<a class="headerlink" href="#discovery-of-the-protocol-controllers" title="Permalink to this heading"></a></h3>
<p>Protocol Controllers will start by advertising themselves as a resource by
publishing to <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;their-unid&gt;/ProtocolController/NetworkManagement</span></code>.
They will be able to issue a payload indicating their current network management
state and what they can do to set up a network.
For more details, see <a class="reference internal" href="Chapter03-network-management.html#unify-specifications-chapter-network-management"><span class="std std-ref">Network Management Commands</span></a>.</p>
<p>An IoT Service can therefore find out more about Protocol Controllers in
general by subscribing to <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/ProtocolController/+</span></code>.</p>
</section>
<section id="discovery-done-by-protocol-controllers">
<h3><span class="section-number">6.1.3. </span>Discovery Done by Protocol Controllers<a class="headerlink" href="#discovery-done-by-protocol-controllers" title="Permalink to this heading"></a></h3>
<p>The Protocol Controllers are devices that are capable to add/remove devices
in their PAN and therefore publish about their identity and capabilities.
For example, after a network inclusion, a Protocol Controller will perform the
necessary node interview, which will allow it to publish about the newly added
PAN node. It is expected that the Protocol Controller assign a unique identifier
to the node and start by publishing using the assigned UNID.</p>
<p>All nodes will have a generic state topic, where general information is
published about the node. The topic is <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;unid&gt;/State</span></code>.</p>
<p>The state topic is a JSON object that MUST follow the following JSON Schema.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UNID State&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;State of a PAN Node&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;enum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Online functional&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Online interviewing&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Online non-functional&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Unavailable&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Offline&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Security&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;enum&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Z-Wave S0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Z-Wave S2 Unauthenticated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Z-Wave S2 Authenticated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Z-Wave S2 Access Control&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Zigbee Z3&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;string&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^(unknown)|(infinite)$&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;NetworkList&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;NetworkStatus&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;MaximumCommandDelay&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The properties in the JSON object of the state topic is shown in
<a class="reference internal" href="#table-unify-specifications-mqtt-topic-state-topic-attributes-overview"><span class="std std-numref">Table 6.1</span></a>.</p>
<table class="colwidths-given docutils align-default" id="table-unify-specifications-mqtt-topic-state-topic-attributes-overview" style="width: 80%">
<caption><span class="caption-number">Table 6.1 </span><span class="caption-text">MQTT Topic State topic attributes overview</span><a class="headerlink" href="#table-unify-specifications-mqtt-topic-state-topic-attributes-overview" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 53%" />
<col style="width: 5%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Mandatory?</p></th>
<th class="head"><p>Example value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NetworkStatus</p></td>
<td><p>Indicates if the node is part of the network or available in general.</p>
<p>This should include intermediate states to give progress feedback</p>
<p>during inclusion. More details about each value is provided in the</p>
<p><a class="reference internal" href="#unify-specifications-chapter-service-discovery-network-status-section"><span class="std std-ref">NetworkStatus</span></a> section.</p>
</td>
<td><p>Yes</p></td>
<td><p>“Online functional”</p>
<p>“Online interviewing”</p>
<p>“Online non-functional”</p>
<p>“Unavailable”</p>
<p>“Offline”</p>
</td>
</tr>
<tr class="row-odd"><td><p>Security</p></td>
<td><p>Indicates the security protocol used by the node to join a network and exchange messages with other nodes.</p></td>
<td><p>Yes</p></td>
<td><p>“Z-Wave S0”</p>
<p>“None”</p>
</td>
</tr>
<tr class="row-even"><td><p>MaximumCommandDelay</p></td>
<td><p>Indicates the maximum delay that it can take to deliver a command to the</p>
<p>node, in seconds. It can either be deterministic (with a precise value),</p>
<p>“unknown”, or “infinite”. It can therefore either be a JSON number or</p>
<p>JSON String.</p>
</td>
<td><p>Yes</p></td>
<td><p>4200</p>
<p>“unknown”</p>
<p>“infinite”</p>
</td>
</tr>
<tr class="row-odd"><td><p>NetworkList</p></td>
<td><p>Indicates the PAN(s) that the node has joined. This should contain an array of one or more unique network identifiers (Network IDs).</p></td>
<td><p>No</p></td>
<td><p>[ “1”, “2”, “3” ]</p></td>
</tr>
</tbody>
</table>
<p>So for example, when a new node joined the network and interview/setup is
completed, the Protocol Controller MUST publish:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/State</span> -
{
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Online functional&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Z-Wave S0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4200</span>
}
</pre></div>
</div>
<p>This will indicate that the node is now operational. It has been securely
included using maximum requested security. For a Wake Up /
sleeping device, there may be a delay before a given command is issued to the
node before a publish back confirms that the application state has changed.
For always listening/reachable nodes, “MaximumCommandDelay” can be set to 0.</p>
<p>A Protocol Controller managing several networks with separate network IDs
may expose the network IDs as an optional parameter in the State topic.
The UNIDs assigned to nodes from each network must be unique.</p>
<p>The network state is shared for all endpoints of a PAN node.</p>
<p>However, an IoT Service still does not know what the node’s capabilities are.
The Protocol Controller is in charge of figuring it out and publish on topics
representing the Endpoints and their ZigBee server clusters.
After they are discovered, the Protocol Controller MUST publish in a
sub-topic under the node’s unid/endpoint the supported commands and attributes
state of a given cluster.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/+/+/&lt;ClusterName&gt;/Attributes/&lt;AttributeName&gt;/Reported</span>
<span class="ow">ucl/by-unid/+/+/&lt;ClusterName&gt;/Attributes/&lt;AttributeName&gt;/Desired</span>
<span class="ow">ucl/by-unid/+/+/&lt;ClusterName&gt;/SupportedCommands</span>
</pre></div>
</div>
<p>It means that when a new node joined the network and interview/setup is
completed, the Protocol Controller figures out the list of supported attributes,
their values, and the list of supported commands that it publishes back under
each endpoint. For example, for a multi-endpoint dimming node (not including all
mandatory attributes here for readability:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Desired</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
<span class="ow">ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
<span class="ow">ucl/by-unid/zw-1234/ep0/OnOff/SupportedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;On&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Off&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Toggle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WriteAttributes&quot;</span><span class="p">]</span>}
<span class="ow">ucl/by-unid/zw-1234/ep0/OnOff/SupportedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;On&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Off&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Toggle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WriteAttributes&quot;</span><span class="p">]</span>}
<span class="ow">ucl/by-unid/zw-1234/ep1/OnOff/Attributes/OnOff/Desired</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>}
<span class="ow">ucl/by-unid/zw-1234/ep1/OnOff/Attributes/OnOff/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
<span class="ow">ucl/by-unid/zw-1234/ep1/OnOff/SupportedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;On&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Off&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Toggle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WriteAttributes&quot;</span><span class="p">]</span>}
<span class="ow">ucl/by-unid/zw-1234/ep2/Level/Attributes/CurrentLevel/Desired</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>}
<span class="ow">ucl/by-unid/zw-1234/ep2/Level/Attributes/CurrentLevel/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>}
<span class="ow">ucl/by-unid/zw-1234/ep2/OnOff/SupportedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:[</span><span class="w"> </span><span class="s2">&quot;MoveToLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Move&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Step&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Stop&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WriteAttributes&quot;</span><span class="p">]</span>}
</pre></div>
</div>
<p>To fit into the proper MQTT topic hierarchy, commands names are stripped
from their “/” and whitespace characters.</p>
<p>To receive the supported commands (used by IoT Service to control end nodes),
the Protocol Controller will subscribe to the topics according to what the node
capabilities are, so that it can receive the commands from other MQTT clients:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep0/OnOff/Commands/WriteAttributes</span>
<span class="ow">ucl/by-unid/984540640/ep0/OnOff/Commands/On</span>
<span class="ow">ucl/by-unid/984540640/ep0/OnOff/Commands/Off</span>
<span class="ow">ucl/by-unid/984540640/ep0/OnOff/Commands/Toggle</span>
<span class="ow">ucl/by-unid/984540640/ep0/Level/Commands/WriteAttributes</span>
<span class="ow">ucl/by-unid/984540640/ep0/Level/Commands/MoveToLevel</span>
</pre></div>
</div>
<p>etc. Alternatively, subscribe to the topic filters:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep0/OnOff/Commands/+</span>
<span class="ow">ucl/by-unid/984540640/ep0/Level/Commands/+</span>
</pre></div>
</div>
<p>The following generic command will always be available for all clusters.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/+/+/&lt;ClusterName&gt;/Commands/WriteAttributes</span>
{
<span class="w">  </span><span class="nt">&quot;AttributeName1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AttributeValue1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;AttributeName2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AttributeValue2&quot;</span>
}
</pre></div>
</div>
<p>If none of the attributes in a cluster are writable (i.e., they are all read-only),
this command will not have any effect.</p>
<p>Commands that cannot be translated by the Protocol Controller translator module
(e.g., Z-Wave Commands that are not translated into any ZigBee Cluster) will
not be advertised as capabilities as it is required that the commands are
translated correctly before delivery to the end node.</p>
<p>Commands will be mapped as topics under each cluster. When an MQTT Client issues
a command that will modify one or more attributes in a cluster, the Protocol
Controller will publish back the list of attributes and their values after it
made sure that the attributes values were correctly changed. For protocols
like Z-Wave, it will include the translator to add Supervision Encapsulation
or issue a subsequent Get Command in order to verify the state/value of each
attribute.</p>
<section id="networkstatus">
<span id="unify-specifications-chapter-service-discovery-network-status-section"></span><h4><span class="section-number">6.1.3.1. </span>NetworkStatus<a class="headerlink" href="#networkstatus" title="Permalink to this heading"></a></h4>
<p>The NetworkStatus property of the UNID state topic JSON object can take the
following values.</p>
<table class="colwidths-given docutils align-default" id="table-unify-specifications-network-status-property-values" style="width: 80%">
<caption><span class="caption-number">Table 6.2 </span><span class="caption-text">NetworkStatus property value</span><a class="headerlink" href="#table-unify-specifications-network-status-property-values" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>“Online interviewing”</p></td>
<td><p>The node has joined the network but it is not ready to be operational yet</p>
<p>because an initial setup and interview need to be done before it can be controlled.</p>
</td>
</tr>
<tr class="row-odd"><td><p>“Online functional”</p></td>
<td><p>The node has joined the network, all required setup is functional, and the</p>
<p>node capabilities are known. IoT Services can fully operate the node.</p>
</td>
</tr>
<tr class="row-even"><td><p>“Online non-functional”</p></td>
<td><p>The node has joined the network and the Protocol Controller can</p>
<p>communicate with it, but important setup failed and therefore its</p>
<p>capabilities may be degraded. It can nonetheless be controlled, but</p>
<p>fewer capabilities than expected may be exposed.</p>
</td>
</tr>
<tr class="row-odd"><td><p>“Unavailable”</p></td>
<td><p>The node has joined the network and is most likely “Online functional”</p>
<p>but the Protocol Controller cannot service any command or state</p>
<p>information at the moment. This can happen, for example if the Protocol</p>
<p>Controller reboots or is offline.</p>
</td>
</tr>
<tr class="row-even"><td><p>“Offline”</p></td>
<td><p>The node has joined the network but cannot be reached by the Protocol</p>
<p>Controller within expected delays. The node has a connectivity issue.</p>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="list-of-endpoints-available-for-nodes">
<h3><span class="section-number">6.1.4. </span>List of endpoints available for nodes<a class="headerlink" href="#list-of-endpoints-available-for-nodes" title="Permalink to this heading"></a></h3>
<p>Protocol Controller SHOULD advertise the list of available endpoints for a
given node and themselves under the topics:</p>
<ul class="simple">
<li><p><strong>ucl/by-unid/&lt;unid&gt;/State/Attributes/EndpointIdList/Reported</strong></p></li>
<li><p><strong>ucl/by-unid/&lt;unid&gt;/State/Attributes/EndpointIdList/Desired</strong></p></li>
</ul>
<p>IoT Services cannot assume that the Endpoint ID list will always be available.</p>
<p>IoT Services can also deduce Endpoints ID based on publications made to the
application clusters for a each endpoint.</p>
</section>
</section>
<section id="mqtt-client-controlling-examples">
<h2><span class="section-number">6.2. </span>MQTT Client Controlling Examples<a class="headerlink" href="#mqtt-client-controlling-examples" title="Permalink to this heading"></a></h2>
<section id="onoff-cluster-control">
<h3><span class="section-number">6.2.1. </span>OnOff Cluster Control<a class="headerlink" href="#onoff-cluster-control" title="Permalink to this heading"></a></h3>
<p>An IoT Service interested only in OnOff Cluster control will subscribe to
the following two topic filters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/+/OnOff/Attributes/#</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/+/OnOff/SupportedCommands</span></code>.</p></li>
</ul>
<p>When an IoT Service receives publish messages, such as
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/98146584/ep10/OnOff/SupportedCommands</span></code>, it will then know that a
Protocol Controller can service commands for the OnOff Cluster for
unid 98146584, endpoint 10.
The MQTT Client can issue the cluster commands (e.g On) to the corresponding
subtopic: <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/98146584/ep10/OnOff/Commands/On</span></code>.</p>
<p>When an IoT Service publishes a command such as
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/98146584/ep10/OnOff/Commands/On</span></code>, the Protocol Controller
will translate the command to one or more commands specific to its PHY to achieve
the desired effect. When the operation is completed, the Protocol Controller
will publish the updated state of the attributes for the cluster server.
In other words, attributes updates within the OnOff Cluster can be used as a confirmation
that the command was executed (or not) and also to tell other MQTT clients
that the state of the end device has changed.</p>
<p>For example, publishing:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/98146584/ep10/OnOff/Attributes/On/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
</pre></div>
</div>
</section>
<section id="delay-in-command-execution">
<h3><span class="section-number">6.2.2. </span>Delay in Command Execution<a class="headerlink" href="#delay-in-command-execution" title="Permalink to this heading"></a></h3>
<p>If an IoT Service wants to display accurate state information, it needs to
subscribe to the <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/State</span></code> topic.
This topic contains information that may affect the way they can expect to
interact with the end device, such as the <code class="docutils literal notranslate"><span class="pre">MaximumCommandDelay</span></code> parameter.
This value indicates how long they have to expect a publish message back showing
the effect of their command in the worst case.</p>
<p>The Maximum Command Delay is identical for all endpoints under an UNID. If a
Protocol Controller has several endpoints that have a different response delay,
this value MUST advertise the worst case scenario.</p>
<p>Every time a desired state or reported state is updated for a given end node,
the Protocol Controller servicing the end node will publish on the State topic.
For example:</p>
<ol class="arabic simple">
<li><p>MQTT Client Publishes</p></li>
</ol>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/98146584/ep10/OnOff/Commands/On</span> - {}
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>The servicing Protocol Controller acknowledges the request and publishes:</p></li>
</ol>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/98146584/ep10/OnOff/Attributes/On/Desired</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span>}
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>When the protocol controller has confirmed that the OnOff device is turned
on, it publishes again the state information:</p></li>
</ol>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/98146584/ep10/OnOff/Attributes/On/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span>}
</pre></div>
</div>
<p>A more detailed example of this mechanism is shown in the diagrams in
<a class="reference internal" href="Chapter02-ZCL-in-uic.html#unify-specifications-chapter-zcl-in-unify-application-level-control"><span class="std std-ref">Dotdot ZCL in Unify Framework for Application Level Control</span></a>.</p>
</section>
<section id="unresponsive-node">
<h3><span class="section-number">6.2.3. </span>Unresponsive Node<a class="headerlink" href="#unresponsive-node" title="Permalink to this heading"></a></h3>
<p>A Protocol Controller will publish using the node state topic when it finds
out that a node is failing and may have left the network. It may not
constantly monitor nodes’ link and it may figure out an unexpected delay when
an MQTT Client publishes to the following:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep3/Identify/Commands/Identify</span> - {<span class="nt">&quot;IdentifyTime&quot;</span><span class="p">:</span><span class="s2">&quot;0x003C&quot;</span>}
</pre></div>
</div>
<p>The Protocol Controller will try to issue the commands and realize that the
node is not responsive. In this case, the Protocol Controller will also publish
back on the node state (instead of usually the cluster state).</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Offline&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bluetooth passkey&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
}
</pre></div>
</div>
<p>If the Protocol Controller needs to advertise that a PAN node is no longer
part of the network, it MUST  publish a zero byte payload with retain flag = 1
at the state and all cluster subtopics belonging to the node:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep0/OnOff/Attributes/OnOff/Reported</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep0/OnOff/Attributes/OnOff/Desired</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep0/OnOff/SupportedCommands</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep0/Level/Attributes/CurrentLevel/Reported</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep0/Level/Attributes/CurrentLevel/Desired</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep0/Level/SupportedCommands</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/OnOff/Attributes/OnOff/Reported</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/OnOff/Attributes/OnOff/Desired</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/OnOff/SupportedCommands</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/Level/Attributes/CurrentLevel/Reported</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/Level/Attributes/CurrentLevel/Desired</span> - No payload
<span class="ow">ucl/by-unid/984540640/ep1/Level/SupportedCommands</span> - No payload
<span class="ow">ucl/by-unid/984540640/State</span> - No payload
</pre></div>
</div>
<p>Doing this will allow MQTT clients to know that the resource is no longer
available and SHOULD be deleted from their node list. Subsequent subscribers
will not receive the retained cluster states and states because of the zero byte
payload.</p>
<p>If a node has dynamic capabilities and a cluster server is removed, the same
procedure must take place and the cluster Attribute and SupportedCommands topics
MUST be published as an empty retained payload. In this case, the State topic
will stay and the node MUST still be shown as available and operational by the
MQTT clients.</p>
</section>
<section id="protocol-controller-is-unable-to-service-pan-nodes">
<h3><span class="section-number">6.2.4. </span>Protocol Controller is Unable to Service PAN Nodes<a class="headerlink" href="#protocol-controller-is-unable-to-service-pan-nodes" title="Permalink to this heading"></a></h3>
<p>A Protocol Controller may be carrying operations that will restrict sending
commands to the end devices. This could for example be rebooting or performing
a firmware update.
When this happens, the Protocol Controller MUST publish on the state of every
UNID it can no longer service, for example if it has four nodes, it will
make the following publications:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540641/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unavailable&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Z-Wave S0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4200</span>
}
</pre></div>
</div>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540642/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unavailable&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
}
</pre></div>
</div>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540643/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unavailable&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Z-Wave S2 Authenticated&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
}
</pre></div>
</div>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540644/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unavailable&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Z-Wave S2 Access Control&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
}
</pre></div>
</div>
<p>This status indicates that any publication made by MQTT clients for this
PAN node will be ignored. MQTT Clients have to wait until the node is online
again.</p>
</section>
</section>
<section id="group-discovery">
<h2><span class="section-number">6.3. </span>Group Discovery<a class="headerlink" href="#group-discovery" title="Permalink to this heading"></a></h2>
<p>The MQTT Topic ucl/by-unid/# is the only one that provides a “per end device”
granularity. The same end nodes will also be represented by conceptual groupings.</p>
<p>For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-location/Kitchen</span></code>: All devices in the kitchen</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-type/DoorLock</span></code>: All Door Lock devices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-group/GroupID</span></code>: Some devices that the user has grouped together for simultaneous actuation</p></li>
</ul>
<section id="by-location">
<h3><span class="section-number">6.3.1. </span>By Location<a class="headerlink" href="#by-location" title="Permalink to this heading"></a></h3>
<p>The location setting can be modified for each individual node using a
dedicated cluster named NameAndLocation. This cluster contains two string
attributes, “Name” and “Location”. This data can be associated with a node/endpoint.</p>
<p>A ResourceDirectory MQTT Client will be in charge of aggregating and
re-distributing this data. Protocol Controllers may not be aware of nodes
names and location and will not use it for anything. The ResourceDirectory
MQTT Client will listen to <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/State</span></code> to get notifications of
new nodes in the network. When a new node is added, it starts by assigning a
default name a location, publish on a cluster for the node, and advertises
it by publishing in the following two topics:</p>
<p>Example :</p>
<ol class="arabic simple">
<li><p>MQTT Client publishes:</p></li>
</ol>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep0/NameAndLocation/Attributes/Name/Desired</span> - {<span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node-984540640&quot;</span><span class="w"> </span>}
<span class="ow">ucl/by-unid/984540640/ep0/NameAndLocation/Attributes/Name/Reported</span> - {<span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node-984540640&quot;</span><span class="w"> </span>}
<span class="ow">ucl/by-unid/984540640/ep0/NameAndLocation/Attributes/Location/Desired</span> - {<span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unknown location&quot;</span><span class="w"> </span>}
<span class="ow">ucl/by-unid/984540640/ep0/NameAndLocation/Attributes/Location/Reported</span> - {<span class="w"> </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unknown location&quot;</span><span class="w"> </span>}
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Resource Directory MQTT Client publishes back:</p></li>
</ol>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-location/unknown_location/984540640</span> - {<span class="w"> </span><span class="nt">&quot;EndpointIdList&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span>}
</pre></div>
</div>
<p>The payload indicates that the node (unid:984540640 / endpoint 0) is available in the
“Unknown location”.</p>
<p>Application MQTT Clients can write a new location for a node/endpoint by publishing for example:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/984540640/ep0/NameAndLocation/WriteAttributes</span> - {
<span class="w">  </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MySuperDoorLock&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Entrance&quot;</span>
}
</pre></div>
</div>
<p>Application MQTT Clients can discover which devices are part of the location
by subscribing to the <code class="docutils literal notranslate"><span class="pre">ucl/by-location/#</span></code> topic.</p>
<p>After a node is added in the network or the name and/or location is set for
a node, the Resource Directory MQTT Client will publish back on both
the <code class="docutils literal notranslate"><span class="pre">ucl/by-location/&lt;location&gt;/&lt;unid&gt;</span></code> with a list of endpoints indicating that
the node is available (e.g., <code class="docutils literal notranslate"><span class="pre">ucl/by-location/living_room/32049350</span></code>
<code class="docutils literal notranslate"><span class="pre">{</span>&#160; <span class="pre">&quot;EndpointIdList&quot;:</span> <span class="pre">[0]</span> <span class="pre">}</span></code>, and the clusters it serves on behalf on
the node <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/984540640/ep0/NameAndLocation</span></code> so that Application
MQTT clients can see all the UNID of the nodes assigned in the locations
they are interested into.</p>
<p>To transmit a message/command to all nodes in the kitchen,
an Application MQTT client needs to publish using individual UNID commands
(plus endpoints). For example, if the kitchen contains two nodes identified
by UNID 32049350/ep0 and 32049351/ep2, the client can publish the following:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/32049350/ep0/OnOff/On</span> - {}
<span class="ow">ucl/by-unid/32049351/ep2/OnOff/On</span> - {}
</pre></div>
</div>
<p>When a node is removed from the network, the ResourceDirectory MQTT Client
will update the location by publishing without the retain flag at
<code class="docutils literal notranslate"><span class="pre">ucl/by-location/&lt;location&gt;/&lt;unid&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;unid&gt;/ep&lt;EndpointID&gt;/NameAndLocation</span></code>
with an empty payload without the retain flag.</p>
</section>
<section id="by-type">
<h3><span class="section-number">6.3.2. </span>By Type<a class="headerlink" href="#by-type" title="Permalink to this heading"></a></h3>
<p>The by-type namespace is postponed for now, because few PHYs use it.
It is always possible to iterate over the by-unid namespace and filter by
Cluster or derive the types manually.</p>
<p>The type is based on the ZCL Device Type. The ZCL device ID type is
read-only and cannot be changed. In ZigBee, it can be read using the
Simple_Desc_Req for each endpoint. The Simple_Desc_rsp contains a 2-byte
field named “Application device identifier”. This group should work in a
similar fashion as the by-location group, except that it is read-only and
clients cannot change the device type of a given node.</p>
</section>
<section id="by-group">
<h3><span class="section-number">6.3.3. </span>By Group<a class="headerlink" href="#by-group" title="Permalink to this heading"></a></h3>
<p>The ZCL also allows to group nodes with actual user-defined groups.
These groups are available under the Groups Cluster (0x0004). The by-group
namespace has the advantage of being both editable and addressable directly.</p>
<p>If an IoT Service wants to control a set of nodes that belong to the same group,
it can issue the commands directly to the GroupId topic.</p>
<p>A helper component is used to keep track of group membership and capabilities,
mimicking the behavior in the <cite>by-unid</cite> space.</p>
<p><strong>Topic:</strong> <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GroupID&gt;/&lt;ClusterName&gt;/Commands/+</span></code></p>
<p>This is the topic on which the Protocol Controllers will listen for incoming
commands that have to be issued to a group of nodes. It works as for any
application level clusters, described in
<a class="reference internal" href="Chapter02-ZCL-in-uic.html#unify-specifications-chapter-zcl-in-unify-application-level-control"><span class="std std-ref">Dotdot ZCL in Unify Framework for Application Level Control</span></a>.</p>
<p>Identically, IoT Service will be able to read the list of supported commands for
each cluster for a given group. This topic will show the common capabilities of
a group, as follows:</p>
<p><strong>Topic:</strong> <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GroupID&gt;/&lt;ClusterName&gt;/SupportedCommands</span></code></p>
<p>The group membership of each node can be seen on the Group cluster
topic of the node itself, but a summary is also available under the following topic:</p>
<p><strong>Topic:</strong> <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GroupID&gt;/NodeList/&lt;UNID&gt;</span></code></p>
<p><strong>JSON Schema:</strong></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://json-schema.org/draft-07/schema#&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Group UNID list&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;List of endpoints under a UNID assigned to individual groups.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integer&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;maximum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">65535</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;minItems&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;value&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The payload under this topic is an array of endpoints under a given UNID that
belong to the group. The array MUST comprise at least 1 element, and an unretained
MQTT message with empty payload indicates that a UNID has no more endpoints
that are part of the actual group.</p>
<p>Each group may have a name assigned to it. The Name of the group will be
advertised at the following topic:</p>
<p><strong>Topic:</strong> <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GroupID&gt;/GroupName</span></code></p>
<p>The JSON-Schema for this topic MUST be identical to the Name attribute defined
the Group Cluster additional attributes,
see <a class="reference internal" href="Chapter02-ZCL-in-uic.html#unify-specifications-chapter-zcl-in-unify-application-level-control"><span class="std std-ref">Dotdot ZCL in Unify Framework for Application Level Control</span></a>.</p>
<p>The name attribute is pushed individually by IoT Service to Protocol Controllers
that forward the information to the PAN nodes. There is a risk that PAN nodes
are assigned as part of the same group (e.g., Group 3) but with different names.</p>
<p>A Group Manager component MUST ensure that GroupName is updated and uniform
for all nodes that are part of the same group.</p>
<section id="protocol-controller-and-groups-topics">
<h4><span class="section-number">6.3.3.1. </span>Protocol Controller and Groups Topics<a class="headerlink" href="#protocol-controller-and-groups-topics" title="Permalink to this heading"></a></h4>
<p>Protocol Controllers will only listen to incoming commands for groups and
dispatch them to individual nodes.</p>
<p>When the group cluster is used to add groups at nodes/enpoints for an end-node,
a Protocol Controller MUST subscribe to group command topic, for example using
one of the following filters:</p>
<ul class="simple">
<li><p>Most specific: <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;groupID&gt;/&lt;ClusterName&gt;/Commands/&lt;CommandName&gt;</span></code></p></li>
<li><p>For all commands: <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;groupID&gt;/&lt;ClusterName&gt;/Commands/+</span></code></p></li>
<li><p>For all commands in any cluster: <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;groupID&gt;/+/Commands/+</span></code></p></li>
<li><p>For any command in any group: <code class="docutils literal notranslate"><span class="pre">ucl/by-group/+/+/Commands/+</span></code></p></li>
</ul>
<p>The following diagram shows an example of controlling PAN nodes that are part
of several groups.</p>
<p class="plantuml">
<img src="../../_images/plantuml-f39c82618d41c5e053716ac648c3dfe6bc002e1f.png" alt="' Allows to do simultaneous transmissions
!pragma teoz true

' Style for the diagram
!theme plain
skinparam LegendBackgroundColor #F0F0F0

title Controlling PAN nodes using the group topics

legend top
&lt;font color=#0039FB&gt;MQTT Subscription&lt;/font&gt;
&lt;font color=#00003C&gt;Retained MQTT Publication&lt;/font&gt;
&lt;font color=#6C2A0D&gt;Unretained MQTT Publication&lt;/font&gt;
endlegend


' List of participants
participant &quot;IoT Service&quot; as iot_service
participant &quot;MQTT Broker&quot; as mqtt_broker
participant &quot;Protocol Controller&quot; as protocol_controller
participant &quot;PAN Node 1\nzw-1234&quot; as pan_node_1
participant &quot;PAN Node 2\nzw-4321&quot; as pan_node_2

protocol_controller -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/Commands/+
protocol_controller -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-group/+/+/Commands/+

rnote over iot_service, pan_node_2: Node inclusion and capabilities discovery, group setup.

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1, 2, 3]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-4321/ep0/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1, 4]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

== ==

iot_service -&gt; mqtt_broker
&amp; mqtt_broker -&gt; protocol_controller : &lt;font color=#6C2A0D&gt;ucl/by-group/0/OnOff/Commands/Toggle

rnote over protocol_controller: no node in group 0.\nCommand is ignored.

== ==

iot_service -&gt; mqtt_broker
&amp; mqtt_broker -&gt; protocol_controller : &lt;font color=#6C2A0D&gt;ucl/by-group/2/OnOff/Commands/On

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller &lt;-&gt; pan_node_1 : PHY commands

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

== ==

iot_service -&gt; mqtt_broker
&amp; mqtt_broker -&gt; protocol_controller : &lt;font color=#6C2A0D&gt;ucl/by-group/1/OnOff/Commands/Off

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-4321/ep0/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; pan_node_1
&amp; protocol_controller -&gt; pan_node_2 : PHY commands

protocol_controller &lt;-&gt; pan_node_1 : PHY commands

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller &lt;-&gt; pan_node_2 : PHY commands

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-4321/ep0/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service"/>
</p>
</section>
<section id="group-manager-helper-component">
<h4><span class="section-number">6.3.3.2. </span>Group Manager Helper Component<a class="headerlink" href="#group-manager-helper-component" title="Permalink to this heading"></a></h4>
<p>Groups MAY span several Protocol Controllers, so the capabilities of a group
will not be advertised by Protocol Controllers themselves.</p>
<p>A special MQTT Client named the “Group Manager” can alleviate the aggregation
logic for other MQTT Clients such as IoT Service that want to make use
of the group functionalities.</p>
<p>The Group Manager will monitor group cluster updates and publish to these three
topics:</p>
<ul class="simple">
<li><p>ucl/by-group/&lt;GroupID&gt;/&lt;ClusterName&gt;/SupportedCommands</p></li>
<li><p>ucl/by-group/&lt;GroupID&gt;/NodeList/&lt;UNID&gt;</p></li>
<li><p>ucl/by-group/&lt;GroupID&gt;/GroupName</p></li>
</ul>
<p>Additionally, the Group Manager MUST publish commands to the individual PAN nodes
using the <code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GroupID&gt;/Groups/Commands/AddGroup</span></code> topic
to keep the Group Names consistent.</p>
<p>An example of the interaction between the different components is shown below:</p>
<p class="plantuml">
<img src="../../_images/plantuml-919758ced46688a598cb8eaf39a201c11b0c9c4c.png" alt="node &quot;MQTT Broker&quot; as mqtt_broker

Package &quot;Group Manager&quot; as group_manager #FFFFFF {
  card group_manager_card #FFFFFF [
    &lt;b&gt;Subscribed to&lt;/b&gt;:
    * ucl/by-unid/+/+/Groups/Attributes/GroupList/Reported
    * ucl/by-unid/+/+/Groups/Attributes/+/Name/Reported
    * ucl/by-unid/+/+/+/SupportedCommands
    &lt;b&gt;Publishes to&lt;/b&gt;:
    * ucl/by-group/&lt;GroupID&gt;/&lt;ClusterName&gt;/SupportedCommands
    * ucl/by-group/&lt;GroupID&gt;/NodeList/&lt;UNID&gt;
    * ucl/by-group/&lt;GroupID&gt;/GroupName
    * ucl/by-group/&lt;GroupID&gt;/Groups/Commands/AddGroup
  ]
  node &quot;Group Manager&quot; as group_manager_1
}

Package &quot;Protocol Controllers&quot; as protocol_controller {
  node &quot;Protocol Controller #1&quot; as protocol_controller_1
  node &quot;Protocol Controller #2&quot; as protocol_controller_2
  card protocol_controller_card #FFFFFF [
    &lt;b&gt;Subscribed to&lt;/b&gt;:
    * ucl/by-group/+/+/Commands/+
    &lt;b&gt;Publishes to&lt;/b&gt;:
    * ucl/by-unid/&lt;UNID&gt;/ep&lt;endpointID&gt;/Groups/Attributes/GroupList/Reported
    * ucl/by-unid/&lt;UNID&gt;/ep&lt;endpointID&gt;/&lt;ClusterName&gt;/SupportedCommands
  ]
}

Package &quot;IoT Services&quot; as iot_service {
  node &quot;IoT Service #1&quot; as iot_service_1
  node &quot;IoT Service #2&quot; as iot_service_2
  card iot_service_card #FFFFFF [
    &lt;b&gt;Subscribed to&lt;/b&gt;:
    * ucl/by-group/+/+/SupportedCommands
    * ucl/by-group/+/NodeList/+
    * ucl/by-group/+/GroupName
    &lt;b&gt;Publishes to&lt;/b&gt;:
    * ucl/by-group/&lt;GroupID&gt;/&lt;ClusterName&gt;/Commands/&lt;CommandName&gt;
    * ucl/by-unid/&lt;UNID&gt;/ep&lt;EndPointID&gt;/Groups/Commands/&lt;CommandName&gt;
  ]
}

group_manager_1 &lt;-down-&gt; mqtt_broker
mqtt_broker &lt;-right-&gt; protocol_controller
mqtt_broker &lt;-down-&gt; iot_service

iot_service_card -[hidden]- iot_service_1
iot_service_card -[hidden]- iot_service_2
protocol_controller_card -[hidden]- protocol_controller_1
protocol_controller_card -[hidden]- protocol_controller_2"/>
</p>
<p>An example for the Group Manager logic is shown in the diagram below.</p>
<p class="plantuml">
<img src="../../_images/plantuml-f50dbb07d698f6083ab9b742bf93c429fede1f13.png" alt="' Allows to do simultaneous transmissions
!pragma teoz true

' Style for the diagram
!theme plain
skinparam LegendBackgroundColor #F0F0F0

title Group manager updates

legend top
&lt;font color=#0039FB&gt;MQTT Subscription&lt;/font&gt;
&lt;font color=#00003C&gt;Retained MQTT Publication&lt;/font&gt;
&lt;font color=#6C2A0D&gt;Unretained MQTT Publication&lt;/font&gt;
endlegend

' List of participants
participant &quot;Group Manager&quot; as group_manager
participant &quot;MQTT Broker&quot; as mqtt_broker

group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/Groups/Attributes/GroupList/Reported
group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/Groups/Attributes/+/Name/Reported
group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/SupportedCommands

== New PAN node joins the group ==

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/NodeList/zw-4321/\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[0]}&lt;/b&gt;

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/Groups/Attributes/1/Name/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:&quot;Kitchen group&quot;}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/GroupName\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:&quot;Kitchen group&quot;}&lt;/b&gt;

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zw-1234/ep0/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot;, &quot;Toggle&quot;, &quot;WriteAttributes&quot; ]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/OnOff/SupportedCommands\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot;, &quot;Toggle&quot;, &quot;WriteAttributes&quot; ]}&lt;/b&gt;

== New PAN node with toggle Command only joins the group ==

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zb-0001/ep0/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;Toggle&quot; ]}&lt;/b&gt;

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zb-0001/ep3/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/NodeList/zb-0001/\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[3]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/OnOff/SupportedCommands\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;Toggle&quot;]}&lt;/b&gt;

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zb-0001/ep3/Groups/Attributes/1/Name/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:&quot;Kitchen Group Renamed&quot;}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#6C2A0D&gt;ucl/by-group/1/Groups/Commands/AddGroup\n&lt;font color=#6C2A0D&gt;&lt;b&gt;{ &quot;GroupId&quot; : 1, &quot;GroupName&quot;: &quot;Kitchen Group Renamed&quot;}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/GroupName\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:&quot;Kitchen Group Renamed&quot;}&lt;/b&gt;

== New PAN node without OnOff Cluster joins the group ==

mqtt_broker -&gt; group_manager : &lt;font color=#00003C&gt;ucl/by-unid/zb-0002/ep1/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/NodeList/zb-0002/\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[2]}&lt;/b&gt;

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/OnOff/SupportedCommands&lt;font color=#00003C&gt;"/>
</p>
</section>
<section id="iot-services-and-groups">
<h4><span class="section-number">6.3.3.3. </span>IoT Services and Groups<a class="headerlink" href="#iot-services-and-groups" title="Permalink to this heading"></a></h4>
<p>The IoT services have the ability to define groups using the application level
group cluster. See <a class="reference internal" href="Chapter02-ZCL-in-uic.html#unify-specifications-chapter-zcl-in-unify-application-level-control"><span class="std std-ref">Dotdot ZCL in Unify Framework for Application Level Control</span></a>.</p>
<p>With the help of the Group Manager component, the IoT services will get notified
of the groups capabilities after each update.</p>
<p>IoT Service SHOULD use names that are already assigned to a GroupID when
manipulating node group membership. i.e., if assigning a PAN Node to GroupID 3,
it SHOULD use the name already assigned to the group by reading the value published
at <cite>ucl/by-group/3/GroupName</cite>.</p>
<p class="plantuml">
<img src="../../_images/plantuml-e1f6d2d174e9d22166b5d6ad978ca92f25a999dd.png" alt="' Allows to do simultaneous transmissions
!pragma teoz true

' Style for the diagram
!theme plain
skinparam LegendBackgroundColor #F0F0F0

title Group usage example using the UCL / Unify Framework

legend top
&lt;font color=#0039FB&gt;MQTT Subscription&lt;/font&gt;
&lt;font color=#00003C&gt;Retained MQTT Publication&lt;/font&gt;
&lt;font color=#6C2A0D&gt;Unretained MQTT Publication&lt;/font&gt;
endlegend


' List of participants
participant &quot;Group Manager&quot; as group_manager
participant &quot;IoT Service&quot; as iot_service
participant &quot;MQTT Broker&quot; as mqtt_broker
participant &quot;Protocol Controller&quot; as protocol_controller

iot_service -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/Attributes/#
iot_service -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/SupportedCommands
iot_service -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-group/+/+/SupportedCommands
iot_service -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-group/+/NodeList/+

protocol_controller -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/Commands/+
protocol_controller -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-group/+/+/Commands/+

group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/Groups/Attributes/GroupList/Reported
group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/Groups/Attributes/+/Name/Reported
group_manager -&gt; mqtt_broker: &lt;font color=#0039FB&gt;ucl/by-unid/+/+/+/SupportedCommands

== New OnOff node 1 joins the network ==

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot;, &quot;Toggle&quot;, &quot;WriteAttributes&quot; ]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service
&amp; mqtt_broker -&gt; group_manager

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/Groups/Attributes/NameSupport/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: {&quot;Supported&quot;:false} }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/Groups/Attributes/NameSupport/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: {&quot;Supported&quot;:false} }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/Groups/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[&quot;AddGroup&quot;, &quot;ViewGroup&quot;, &quot;GetGroupMembership&quot;,\n&lt;font color=#00003C&gt;&lt;b&gt;&quot;RemoveGroup&quot;, &quot;RemoveAllGroups&quot;, &quot;AddGroupIfIdentifying&quot;]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

== New OnOff node 2 joins the network ==

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: false }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot; ]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service
&amp; mqtt_broker -&gt; group_manager

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/Groups/Attributes/NameSupport/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: {&quot;Supported&quot;:false} }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/Groups/Attributes/NameSupport/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{ &quot;value&quot;: {&quot;Supported&quot;:false} }&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/Groups/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[&quot;AddGroup&quot;, &quot;ViewGroup&quot;, &quot;GetGroupMembership&quot;,\n&lt;font color=#00003C&gt;&lt;b&gt;&quot;RemoveGroup&quot;, &quot;RemoveAllGroups&quot;, &quot;AddGroupIfIdentifying&quot;]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

== OnOff node 1 joins Group 1 ==

iot_service -&gt; mqtt_broker : &lt;font color=#6C2A0D&gt;ucl/by-unid/zw-0001/ep0/Groups/Commands/AddGroup \n&lt;font color=#6C2A0D&gt;&lt;b&gt;{ &quot;GroupId&quot; : 1, &quot;GroupName&quot;: &quot;Kitchen&quot;}&lt;/b&gt;
&amp; mqtt_broker -&gt; protocol_controller

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/Groups/Attributes/GroupList/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service
&amp; mqtt_broker -&gt; group_manager

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/NodeList/zw-0001\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[0]}&lt;/b&gt;
mqtt_broker --&gt; iot_service

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/GroupName\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: &quot;Kitchen&quot;}&lt;/b&gt;
mqtt_broker --&gt; iot_service

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot;, &quot;Toggle&quot;, &quot;WriteAttributes&quot; ]}&lt;/b&gt;
mqtt_broker --&gt; iot_service

== OnOff node 2 joins Group 1 ==

iot_service -&gt; mqtt_broker : &lt;font color=#6C2A0D&gt;ucl/by-unid/zw-0002/ep2/Groups/Commands/AddGroup \n&lt;font color=#6C2A0D&gt;&lt;b&gt;{ &quot;GroupId&quot; : 1, &quot;GroupName&quot;: &quot;Kitchen&quot;}&lt;/b&gt;
&amp; mqtt_broker -&gt; protocol_controller

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/Groups/Attributes/GroupList/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/Groups/Attributes/GroupList/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[1]}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service
&amp; mqtt_broker -&gt; group_manager

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/NodeList/zw-0002\n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[2]}&lt;/b&gt;
mqtt_broker --&gt; iot_service

group_manager -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-group/1/OnOff/SupportedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;:[ &quot;On&quot;, &quot;Off&quot;]}&lt;/b&gt;
mqtt_broker --&gt; iot_service


== Group 1 get turned on ==

iot_service -&gt; mqtt_broker : &lt;font color=#6C2A0D&gt;ucl/by-group/1/OnOff/Commands/On
&amp; mqtt_broker -&gt; protocol_controller

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/OnOff/Attributes/OnOff/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

... Command Execution ...

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0001/ep0/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service

protocol_controller -&gt; mqtt_broker : &lt;font color=#00003C&gt;ucl/by-unid/zw-0002/ep2/OnOff/Attributes/OnOff/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: true}&lt;/b&gt;
&amp; mqtt_broker -&gt; iot_service"/>
</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2023 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>