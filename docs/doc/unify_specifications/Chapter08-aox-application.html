<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="Unify AoX Application" name="description" />
<meta content="AoX, Locator, Asset, Tag" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. AoX Application &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/doc/unify_specifications/Chapter08-aox-application.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/charenc.js"></script>
        <script src="../../_static/js/crypt.js"></script>
        <script src="../../_static/js/sha1.js"></script>
        <script src="../../_static/js/html5-qrcode.min.js"></script>
        <script src="../../_static/js/qr_code_scanner.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Binding" href="Chapter09-binding.html" />
    <link rel="prev" title="7. The Dotdot Scenes Cluster (0x0005) in the Unify Framework" href="Chapter07-scenes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../introduction.html" class="icon icon-home"> Unify
            <img src="../../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.3.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Unify Host SDK</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../UnifySDK.html">Unify Framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#systems-overview">Systems Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#unify-applications-overview">Unify Applications Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#overview-of-relations-among-unify-applications">Overview of relations among Unify Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#overview-of-communication-among-unify-framework-applications">Overview of communication among Unify Framework Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#unify-framework-release-notes">Unify Framework Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../UnifySDK.html#unify-framework-developer-guides">Unify Framework Developer Guides</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../UnifySDK.html#resources">Resources</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Unify Specifications</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="Chapter01-architecture-overview.html">1. Unify Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter02-ZCL-in-uic.html">2. Dotdot ZCL in Unify Framework for Application Level Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter03-network-management.html">3. Network Management Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter04-scenario-mappings.html">4. Scenario mapping to specific PHYs: Z-Wave, BLE and ZigBee</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter05-common-ota.html">5. Common OTA FW Update Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter06-service-discovery.html">6. Service Discovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter07-scenes.html">7. Scene Cluster and the Scene Table</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">8. AoX Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter09-binding.html">9. Binding</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter10-name-and-location-service.html">10. Name and Location Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter11-system-metrics.html">11. System Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="Chapter12-unify-applications-monitoring.html">12. Unify Applications Monitoring</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../standards/known-abbreviations.html">Known Abbreviations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../multiprotocol.html">Multiprotocol Host Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started with the Unify Host SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme_developer.html">Unify Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr_code_scanner.html">QR-Code Scanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="aox-application">
<span id="unify-specifications-chapter-aox-application"></span><h1><span class="section-number">8. </span>AoX Application<a class="headerlink" href="#aox-application" title="Permalink to this heading"></a></h1>
<p>This chapter contains cluster definitions used to support the AoX application.
These cluster definitions are unique to the Unify Controller Language.
This is an addition to the clusters already defined in the ZCL.</p>
<section id="terminology">
<h2><span class="section-number">8.1. </span>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading"></a></h2>
<p>We define here several entities as part of an AoX system:</p>
<ul>
<li><p><strong>Assets Tags</strong></p>
<p>Assets tags are radio devices sending unencrypted radio beacons
that allow to triangulate assets.</p>
</li>
<li><p><strong>AoX Protocol Controller / Locator</strong></p>
<p>The AoXPC is a component that processes incoming radio beacons, converts
them into IQ Reports or Angle reports, which will allow another component
to compute the position of the device.
A locator is a part of the AoX Protocol Controller, it is basically an NCP
with a configuration that will help to determine the relative position of
an asset tag.</p>
</li>
<li><p><strong>AoX Positioning Service</strong></p>
<p>This is essentially a helper component (like the SmartStart list manager)
that reads the data reported from the locators and will compute and publish
the absolute position of each tag.</p>
</li>
</ul>
<p>The system can be seen as follows:</p>
<p class="plantuml">
<img src="../../_images/plantuml-e058370d9cd922b8aff3acf42e2f611e03fd4212.png" alt="' Style for the diagram
allow_mixing
skinparam objectBorderColor black

title AoX components overview

package &quot;RF Area&quot; &lt;&lt;Cloud&gt;&gt; {

    object &quot;AoXPC&quot; as aox_pc #FFFFFF
    aox_pc : ble-locator-1111

    object &quot;AoXPC&quot; as aox_pc_2 #FFFFFF
    aox_pc_2 : ble-locator-2222

    package &quot;Assets&quot; &lt;&lt;Rectangle&gt;&gt; {
        object &quot;Asset Tag 1&quot; as tag_1 #FFFFFF
        object &quot;Asset Tag 2&quot; as tag_2 #FFFFFF
        object &quot;Asset Tag 3&quot; as tag_3 #FFFFFF
        object &quot;Asset Tag 4&quot; as tag_4 #FFFFFF
    }
}

object &quot;MQTT Broker&quot; as mqtt_broker #FFFFFF
object &quot;AoX Positioning Service&quot; as positioning_service #FFFFFF

aox_pc -[hidden]right- aox_pc_2

tag_1 -up-&gt; aox_pc: beacons
tag_2 -up-&gt; aox_pc
tag_3 -up-&gt; aox_pc
tag_4 -up-&gt; aox_pc

tag_1 -up-&gt; aox_pc_2
tag_2 -up-&gt; aox_pc_2
tag_3 -up-&gt; aox_pc_2
tag_4 -up-&gt; aox_pc_2

aox_pc -&gt; mqtt_broker : tag_1 data (ble-locator-1111)
aox_pc_2 -&gt; mqtt_broker : tag_1 data (ble-locator-2222)

mqtt_broker -down-&gt; positioning_service: tags raw data\nlocator configuration
positioning_service -up-&gt; mqtt_broker : tags estimated position"/>
</p>
</section>
<section id="aox-clusters">
<h2><span class="section-number">8.2. </span>AoX Clusters<a class="headerlink" href="#aox-clusters" title="Permalink to this heading"></a></h2>
<p>This section defines how to represent Angle-of-X (e.g, Angle of Arrival) IQ
report, Angle, and Position data in the Unify Framework.</p>
<p>The AoX system relies on several new clusters:</p>
<ul class="simple">
<li><p>AoXLocator, used to manage locator devices within the AoXPC.</p></li>
<li><p>AoXPositionEstimation, used to report Assets estimated position.</p></li>
</ul>
<section id="locators-and-the-aoxlocator-cluster">
<h3><span class="section-number">8.2.1. </span>Locators and the AoXLocator cluster<a class="headerlink" href="#locators-and-the-aoxlocator-cluster" title="Permalink to this heading"></a></h3>
<p>The AoX Protocol Controller allows to read the configuration of its
Locator using the AoXLocator Cluster. For example, an AoX Protocol Controller
could advertise it like this:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientationValid/Desired</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
<span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientationValid/Reported</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>}
<span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientation/Desired</span> - {
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;CoordinateX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.75</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;CoordinateY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;CoordinateZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.25</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span>}
}
<span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/PositionAndOrientation/Reported</span> - {
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;CoordinateX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.75</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;CoordinateY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;CoordinateZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.25</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OrientationZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span>}
}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">PositionAndOrientation</span></code> represents the the location of the NCP radio
for the AoX locator. CoordinateX, CoordinateY, CoordinateZ are cartesian
coordinates, in meters. OrientationX, OrientationY and OrientationZ are the
axis rotation (Euler angles) in degrees.
More details are provided in
<a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#structsl-rtl-loc-locator-item">Silicon Labs RTL Locator item</a></p>
<p>The additional <code class="docutils literal notranslate"><span class="pre">PositionAndOrientationValid</span></code> boolean attribute indicates if
the locator <code class="docutils literal notranslate"><span class="pre">PositionAndOrientation</span></code> attributes has been set
and the reported values reported are correct.</p>
<p>A subscription to <cite>ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/Attributes/#</cite> will allow
to read the entire configuration and possibly write back the configuration
that is writable.</p>
<p>The AoXLocator Cluster can be configured using the AoXLocator cluster
<strong>WriteAttributes</strong> command.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;AngleCorrection&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WriteAttributes&quot;</span><span class="p">]</span>}
<span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedGeneratedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;IQReport&quot;</span><span class="p">]</span>}
</pre></div>
</div>
<p>An AoX Protocol Controller MUST generate an <cite>IQReport</cite> or an <cite>AngleReport</cite> Command
for every radio beacon that has been received by a locator.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/GeneratedCommands/IQReport</span> - {
<span class="w">  </span><span class="nt">&quot;TagUnid&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ble-pd-842E1431C9F0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Rssi&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-50</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42767</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Samples&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="mi">106</span><span class="p">,</span><span class="w"> </span><span class="mi">-10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">-108</span><span class="p">]</span>
}
</pre></div>
</div>
<p>Or</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/GeneratedCommands/AngleReport</span> -
{
<span class="w">  </span><span class="nt">&quot;Deviation&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;Azimuth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Elevation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span>}<span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Direction&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;Azimuth&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-6.4180755615234375</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.5519763231277466</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Elevation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">51.71907043457031</span>
<span class="w">  </span>}<span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42767</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;TagUnid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ble-pd-842E1431C9F0&quot;</span>
}
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">AngleReport</span></code> commands, <code class="docutils literal notranslate"><span class="pre">Direction</span></code> represents the measured angle data
while <code class="docutils literal notranslate"><span class="pre">Deviation</span></code> indicates the standard deviation of the that measurement.
Both <code class="docutils literal notranslate"><span class="pre">Direction</span></code> and <code class="docutils literal notranslate"><span class="pre">Deviation</span></code> are spherical coordinates.
In sphrical coordinates objects, the <code class="docutils literal notranslate"><span class="pre">Azimuth</span></code> and <code class="docutils literal notranslate"><span class="pre">Elevation</span></code> are in degrees and
the <code class="docutils literal notranslate"><span class="pre">Distance</span></code> is in meter.</p>
<p>More details about how to interpret the values in the IQReports or AngleReports
are given in
<a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/">Silicon Labs RTL Library</a>
and
<a class="reference external" href="https://www.silabs.com/documents/public/user-guides/ug103-18-bluetooth-direction-finding-fundamentals.pdf">Silicon Labs User Guide 103.18</a></p>
<p>Each locator will generate ‘IQReport’ or ‘AngleReport’.
Locators supporting both modes will advertise which mode is configured
using the <code class="docutils literal notranslate"><span class="pre">ReportingMode</span></code> attribute configuration.
If the <code class="docutils literal notranslate"><span class="pre">ReportingMode</span></code> attribute is not writable, it will not be advertised
and instead IoT Services will be able to know what commands are generated reading
the value published at the SupportedGeneratedCommands topic:</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;aoxpc_unid&gt;/ep0/AoXLocator/SupportedGeneratedCommands</span> - {<span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;AngleReport&quot;</span><span class="p">]</span>}
</pre></div>
</div>
<p>For example, the following diagram shows an example of configuring which
commands are generated by a locator.</p>
<p class="plantuml">
<img src="../../_images/plantuml-93772063b7c03aed5c75dedc34aa1256b2cb8279.png" alt="' Allows simultaneous transmissions
!pragma teoz true

' Style for the diagram
!theme plain
skinparam LegendBackgroundColor #F0F0F0

title Configuring IQReport or AngleReports for an AoX Locator

legend top
&lt;font color=#0039FB&gt;MQTT Subscription&lt;/font&gt;
&lt;font color=#00003C&gt;Retained MQTT Publication&lt;/font&gt;
&lt;font color=#6C2A0D&gt;Unretained MQTT Publication&lt;/font&gt;
&lt;font color=#000000&gt;PHY messages&lt;/font&gt;
endlegend

' List of participants
participant &quot;IoT Service&quot; as iot_service

participant &quot;AoX Protocol Controller\nUNID: pc&quot; as protocol_controller
participant &quot;Asset Tag 1\nUNID: tag_1&quot; as tag_1

protocol_controller -&gt; iot_service: &lt;font color=#00003C&gt;ucl/by-unid/pc/ep0/AoXLocator/Attributes/ReportingMode/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: &quot;IQReport&quot;}

protocol_controller -&gt; iot_service: &lt;font color=#00003C&gt;ucl/by-unid/pc/ep0/AoXLocator/SupportedGeneratedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: [&quot;IQReport&quot;]}

rnote over protocol_controller: AoX Locator\nis configured to\nsend IQReport

tag_1 -&gt; protocol_controller: Beacon

protocol_controller -&gt; iot_service: &lt;font color=#6C2A0D&gt;ucl/by-unid/pc/ep0/AoXLocator/GeneratedCommands/IQReport \n&lt;font color=#6C2A0D&gt;&lt;b&gt;{IQREport data}

rnote over iot_service: I want AngleReports

iot_service -&gt; protocol_controller: &lt;font color=#6C2A0D&gt;ucl/by-unid/pc/ep0/AoXLocator/Commands/WriteAttributes \n&lt;font color=#6C2A0D&gt;&lt;b&gt;{&quot;ReportingMode&quot; =  &quot;AngleReport&quot;}

protocol_controller -&gt; iot_service: &lt;font color=#00003C&gt;ucl/by-unid/pc/ep0/AoXLocator/Attributes/ReportingMode/Desired \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: &quot;AngleReport&quot;}

protocol_controller -&gt; iot_service: &lt;font color=#00003C&gt;ucl/by-unid/pc/ep0/AoXLocator/Attributes/ReportingMode/Reported \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: &quot;AngleReport&quot;}

protocol_controller -&gt; iot_service: &lt;font color=#00003C&gt;ucl/by-unid/pc/ep0/AoXLocator/SupportedGeneratedCommands \n&lt;font color=#00003C&gt;&lt;b&gt;{&quot;value&quot;: [&quot;AngleReport&quot;]}

rnote over protocol_controller: AoX Locator\nis configured to\nsend AngleReport

tag_1 -&gt; protocol_controller: Beacon

protocol_controller -&gt; iot_service: &lt;font color=#6C2A0D&gt;ucl/by-unid/pc/ep0/AoXLocator/GeneratedCommands/AngleReport \n&lt;font color=#6C2A0D&gt;&lt;b&gt;{AngleReport data}"/>
</p>
<section id="anglecorrection-command">
<h4><span class="section-number">8.2.1.1. </span>AngleCorrection Command<a class="headerlink" href="#anglecorrection-command" title="Permalink to this heading"></a></h4>
<p>For calibration and accuracy purposes, AoX locators
generating <code class="docutils literal notranslate"><span class="pre">AngleReport</span></code> commands SHOULD support receiving the
<code class="docutils literal notranslate"><span class="pre">AngleCorrection</span></code> command. The <code class="docutils literal notranslate"><span class="pre">AngleCorrection</span></code> command
will indicate what values are expected for a given asset tag to an AoX locator.</p>
<p>Details on applying angle correction are given in
<a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#ga788dcffb47a4bbb26b110bb9e817b0e5">Silicon Labs RTL Library: Get expected direction</a></p>
</section>
</section>
<section id="aoxpositionestimation-cluster">
<h3><span class="section-number">8.2.2. </span>AoXPositionEstimation cluster<a class="headerlink" href="#aoxpositionestimation-cluster" title="Permalink to this heading"></a></h3>
<p>A Positioning Service helper MQTT client can be used to listen to MQTT
publications coming from the AoXLocator cluster to determine the
position of each tag in the system.</p>
<p>The Positioning Service does not have a UNID itself. It connects to the
MQTT broker, and performs the following actions:</p>
<ol class="arabic simple">
<li><p>Read/Write the configuration:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Reads the configuration for each AoXPC / Locator, using a subscription to
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/+/AoXLocator/Attributes/+/Reported</span></code></p></li>
<li><p>Optionally adjusts the configuration issuing WriteAttributes Command
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/+/AoXLocator/Commands/WriteAttributes</span></code></p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Listen to incoming IQReport or AngleReports by subscribing to:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/+/+/AoXLocator/GeneratedCommands/+</span></code></p></li>
</ol>
<p>Whenever position data for a tag is available, the Positioning Service MUST
publish the calculated Position attribute in the AoXPositionEstimation Cluster.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;TAG_UNID&gt;/ep0/AoXPositionEstimation/Attributes/Position/Reported</span> -
  {
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;ApplicationId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;positioning_4154&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.1297969818115234</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.6999226212501526</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.8446271419525146</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">47021</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8519021272659302</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.000349800189724192</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8335742950439453</span>
<span class="w">  </span>}
}
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">Position</span></code> attribute, Coordinate components (<code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code>, etc.) unit is
Meter.</p>
<p>The first time that a tag’s position is determined, or a new tag is detected,
the Positioning Service application MUST publish a node state topic for that tag.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;TAG_UNID&gt;/State</span> - {
<span class="w">  </span><span class="nt">&quot;NetworkStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Online functional&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Security&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;MaximumCommandDelay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span>
}
</pre></div>
</div>
<p>When a Positioning Service application shuts down, it MUST unretain
all the AoXPositionEstimation and State data that it published for tags.</p>
</section>
<section id="positioning-service">
<h3><span class="section-number">8.2.3. </span>Positioning Service<a class="headerlink" href="#positioning-service" title="Permalink to this heading"></a></h3>
<p>The Positioning Service is a helper component that can determine
spatial coordinates, or position, for each tag UNID and publises the last
reported position.</p>
</section>
<section id="asset-tag-unids">
<h3><span class="section-number">8.2.4. </span>Asset Tag UNIDs<a class="headerlink" href="#asset-tag-unids" title="Permalink to this heading"></a></h3>
<p>Asset Tag UNIDs MUST indicate the BLE address type in addition to the BLE address.
The generic format is <cite>ble-&lt;ADDRESS_TYPE&gt;-&lt;BLE_ADDRESS&gt;</cite>.
Refer to <a class="reference internal" href="Chapter01-architecture-overview.html#unify-specifications-chapter-architecture-overview"><span class="std std-ref">Unify Architecture Overview</span></a>
for details about UNID composition.
Static random addresses can be abbreviated <strong>sr</strong> and public device addresses <strong>pd</strong>.</p>
<p>An example of a public device address UNID is <code class="docutils literal notranslate"><span class="pre">ble-pd-842E1431C9F0</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2023 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>