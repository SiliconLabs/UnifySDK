<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZigPC User’s Guide &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/applications/zigpc/readme_user.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ZigPC Developer Guide" href="readme_developer.html" />
    <link rel="prev" title="AoXPC Developer’s Guide" href="../aox/applications/aoxpc/readme_developer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../doc/introduction.html" class="icon icon-home"> Unify
            <img src="../../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../doc/introduction.html">Unify Host SDK</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../doc/UnifySDK.html">Unify Framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#systems-overview">Systems Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc/UnifySDK.html#unify-applications-overview">Unify Applications Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../doc/UnifySDK.html#unify-framework-protocol-controllers">Unify Framework Protocol Controllers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../aox/applications/aoxpc/readme_user.html">AoXPC User Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aox/applications/aoxpc/readme_developer.html">AoXPC Developer’s Guide</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">ZigPC User’s Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="readme_developer.html">ZigPC Developer Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="coding_standard.zigpc.html">ZigPC Coding Standard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../zpc/readme_user.html">ZPC User’s Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../zpc/readme_certification.html">ZPC Certification Information</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../doc/UnifySDK.html#the-unify-framework-services">The Unify Framework Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../doc/UnifySDK.html#iot-services">IoT Services</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#overview-of-relations-among-unify-applications">Overview of relations among Unify Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#overview-of-communication-among-unify-framework-applications">Overview of communication among Unify Framework Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#unify-framework-release-notes">Unify Framework Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#unify-framework-developer-guides">Unify Framework Developer Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/UnifySDK.html#resources">Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/multiprotocol.html">Multiprotocol Host Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/getting_started.html">Getting Started with the Unify Host SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/readme_developer.html">Unify Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../doc/introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="zigpc-users-guide">
<h1>ZigPC User’s Guide<a class="headerlink" href="#zigpc-users-guide" title="Permalink to this heading"></a></h1>
<p>This document is a user guide for the Zigbee Protocol controller (ZigPC).
The primary role of ZigPC is to allow Zigbee devices to be monitored and
controlled using the Unify Controller Language (UCL).</p>
<p><br><br></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The Unify Framework provides a consolidated API to observe and control devices that
communicate using different sensor network protocols (Zigbee, Z-Wave, and so on)
with the help of Unify Protocol Controllers.</p>
<p>An MQTT broker is at the core of Unify Framework. It is used by Protocol Controllers to
send and receive commands and information from other Unify components using the
Unify Controller Language (UCL).</p>
<p>The Zigbee Protocol Controller (ZigPC) is an opinionated Zigbee gateway that
act as a Unify gateway, as specified in the Unify Specification.</p>
<p>ZigPC uses the Zigbee Host-NCP model to relay messages from Unify to the end
device where EZSP is used as the serial protocol to communicate with the NCP.</p>
<p><br><br></p>
</section>
<section id="hardware-prerequisites">
<h2>Hardware Prerequisites<a class="headerlink" href="#hardware-prerequisites" title="Permalink to this heading"></a></h2>
<p>Running Unify with ZigPC requires the following equipment:</p>
<section id="gateway-host-device-raspberry-pi">
<h3>Gateway Host Device: Raspberry Pi<a class="headerlink" href="#gateway-host-device-raspberry-pi" title="Permalink to this heading"></a></h3>
<p>ZigPC is officially supported on a Raspberry Pi 4 running Debian Buster (A.K.A.
Raspberry Pi OS).</p>
<p>For installation and setup, follow steps outlined in:
<a class="reference external" href="https://www.raspberrypi.org/documentation/">https://www.raspberrypi.org/documentation/</a></p>
<p>Find more information about Raspberry Pi OS here:
<a class="reference external" href="https://www.raspberrypi.org/downloads/raspberry-pi-os/">https://www.raspberrypi.org/downloads/raspberry-pi-os/</a></p>
</section>
<section id="gateway-ncp-device">
<h3>Gateway NCP Device<a class="headerlink" href="#gateway-ncp-device" title="Permalink to this heading"></a></h3>
<p>Supported radios: EFR32MG1X or EFR32MG2X
Supported EZSP protocol: UART (SPI not officially supported)</p>
</section>
<section id="pan-zigbee-device">
<h3>PAN Zigbee Device<a class="headerlink" href="#pan-zigbee-device" title="Permalink to this heading"></a></h3>
<p>Currently supported Zigbee device provisioning methods:</p>
<ul class="simple">
<li><p>Zigbee 3.0 with Install Code</p></li>
<li><p>Zigbee 3.0 with Well-Known-Key</p></li>
</ul>
<p>See the Appendix section at the bottom of the guide for steps to configure
example NCP and Z3Light device FW images.</p>
<p><br><br></p>
</section>
</section>
<section id="installing-zigpc">
<h2>Installing ZigPC<a class="headerlink" href="#installing-zigpc" title="Permalink to this heading"></a></h2>
<p>All of the Unify components below (MQTT Broker, UPVL client and GMS client)
should be installed before running the ZigPC. Running Unify with ZigPC requires
using an MQTT Broker. Unify currently supports using Mosquitto MQTT
(<a class="reference external" href="https://mosquitto.org/">https://mosquitto.org/</a>).</p>
<p>For installing please refer to the general installation method in
<a class="reference internal" href="../../doc/getting_started.html"><span class="doc std std-doc">Getting started</span></a>.</p>
<section id="description-of-installed-components">
<h3>Description of Installed Components<a class="headerlink" href="#description-of-installed-components" title="Permalink to this heading"></a></h3>
<p>After the packages are installed, the following services and libraries are
available on the Raspberry Pi:</p>
<section id="mosquitto-mqtt-system-service">
<h4>Mosquitto MQTT System Service<a class="headerlink" href="#mosquitto-mqtt-system-service" title="Permalink to this heading"></a></h4>
<p>The Mosquitto MQTT broker is installed as a system service running in the
background. It should be started before attempting to launch any Unify component.
Otherwise, Unify components may not launch properly and may not communicate to each
other properly.</p>
</section>
<section id="mosquitto-mqtt-clients-mosquitto-pub-mosquitto-sub">
<h4>Mosquitto MQTT Clients: mosquitto_pub, mosquitto_sub<a class="headerlink" href="#mosquitto-mqtt-clients-mosquitto-pub-mosquitto-sub" title="Permalink to this heading"></a></h4>
<p>The Mosquitto publish &amp; subscribe tools can be used to interact with the Unify
MQTT broker by providing a topic and a message payload (if publishing).</p>
</section>
<section id="libuic-so">
<h4><a class="reference external" href="http://libuic.so">libuic.so</a><a class="headerlink" href="#libuic-so" title="Permalink to this heading"></a></h4>
<p>This library contains the runtime dependencies used by some Unify components
(including ZigPC). See
<a class="reference internal" href="../../doc/readme_developer.html"><span class="doc std std-doc">Unify Framework Library Developer Guide</span></a>
for more details.</p>
</section>
<section id="uic-upvl">
<h4>uic-upvl<a class="headerlink" href="#uic-upvl" title="Permalink to this heading"></a></h4>
<p>The Unify Framework Provisioning List (UPVL)
maintains the UCL SmartStart topics (and its List, Update, and Remove
subtopics. See <a class="reference internal" href="../upvl/readme_user.html"><span class="doc std std-doc">UPVL User Guide</span></a> for more
details.</p>
</section>
<section id="uic-gms">
<h4>uic-gms<a class="headerlink" href="#uic-gms" title="Permalink to this heading"></a></h4>
<p>Unify IoT service that book-keeps groups data among different Protocol
Controllers. It manages the ucl/by-group/# topic space. See
<a class="reference internal" href="../gms/readme_user.html"><span class="doc std std-doc">GMS User Guide</span></a> for more details.</p>
</section>
<section id="uic-image-provider">
<h4>uic-image-provider<a class="headerlink" href="#uic-image-provider" title="Permalink to this heading"></a></h4>
<p>Unify IoT service that stores and distributes OTA Firmware images for Protocol
Controllers over UCL. It manages the ucl/OTA/# topic space. See
<a class="reference internal" href="../image_provider/readme_user.html"><span class="doc std std-doc">Image Provider User’s Guide</span></a> for
more details.</p>
</section>
<section id="zigpc">
<h4>zigpc<a class="headerlink" href="#zigpc" title="Permalink to this heading"></a></h4>
<p>The Zigbee Protocol Controller application connects to the Mosquitto MQTT
broker, sets up a PAN as a Zigbee Coordinator, and relays messages using the
Zigbee NCP connected on a serial port.</p>
<p><br><br></p>
</section>
</section>
</section>
<section id="starting-zigpc-on-the-command-line">
<h2>Starting ZigPC on the Command Line<a class="headerlink" href="#starting-zigpc-on-the-command-line" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Run the MQTT Broker on the Raspberry Pi.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl start mosquitto
systemctl status mosquitto

<span class="c1"># If you encounter problems with running the service, logs can be received by running</span>
journalctl -u mosquitto
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run the UPVL application on the Raspberry Pi by following instructions in
the <a class="reference internal" href="../upvl/readme_user.html"><span class="doc std std-doc">UPVL User Guide</span></a>.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure uic-upvl is running</span>
sudo systemctl status uic-upvl

<span class="c1"># NOTE: If it has stopped or not running, run the following commands:</span>
<span class="c1">#     sudo systemctl enable uic-upvl</span>
<span class="c1">#     sudo systemctl start uic-upvl</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Run the Group Management Service application on the Raspberry Pi by following instructions in
the <a class="reference internal" href="../gms/readme_user.html"><span class="doc std std-doc">GMS User Guide</span></a>.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure uic-gms is running</span>
sudo systemctl status uic-gms

<span class="c1"># NOTE: If it has stopped or not running, run the following commands:</span>
<span class="c1">#     sudo systemctl enable uic-gms</span>
<span class="c1">#     sudo systemctl start uic-gms</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Run the Image provider application on the Raspberry Pi by following instructions in
the <a class="reference internal" href="../image_provider/readme_user.html"><span class="doc std std-doc">Image Provider User Guide</span></a>.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure uic-image-provider is running</span>
sudo systemctl status uic-image-provider

<span class="c1"># NOTE: If it has stopped or not running, run the following commands:</span>
<span class="c1">#     sudo systemctl enable uic-image-provider</span>
<span class="c1">#     sudo systemctl start uic-image-provider</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Run ZigPC on the Raspberry Pi with the serial port to the flashed Zigbee NCP.
<strong>Running ZigPC as a system service</strong>
Once installed, ZigPC will be configured to run as a system service by default.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure uic-zigpc is running</span>
sudo systemctl status uic-zigpc

<span class="c1"># NOTE: If it has stopped or not running, run the following commands:</span>
<span class="c1">#     sudo systemctl enable uic-zigpc</span>
<span class="c1">#     sudo systemctl start uic-zigpc</span>

<span class="c1"># NOTE: To stop running zigpc as a system service, run the following commands:</span>
<span class="c1">#     sudo systemctl stop uic-zigpc</span>
<span class="c1">#     sudo systemctl disable uic-zigpc</span>
</pre></div>
</div>
<p>The configuration used by the service can be found at <code class="docutils literal notranslate"><span class="pre">etc/uic/uic.cfg</span></code></p>
<p><strong>Running ZigPC on the command line</strong>
If ZigPC is not running a system service</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>zigpc --zigpc.serial /dev/ttyACM0 --mqtt.host <span class="m">0</span>.0.0.0 --mqtt.port <span class="m">1883</span> --zigpc.datastore_file zigpc.db
</pre></div>
</div>
<blockquote>
<div><p><em>NOTE: Run <code class="docutils literal notranslate"><span class="pre">zigpc</span> <span class="pre">--help</span></code> to see a full list of supported parameters</em></p>
</div></blockquote>
<blockquote>
<div><p><em>NOTE: ZigPC serial argument point to the UART-EZSP port exposed by the Zigbee NCP. This path will be different based on the configuration of tty devices connected to your Raspberry Pi</em></p>
</div></blockquote>
<blockquote>
<div><p><em>NOTE: Ensure ZigPC is only running as a system service or via the CLI and not both</em></p>
</div></blockquote>
<p><br><br></p>
</section>
<section id="using-zigpc-in-a-multiprotocol-configuration">
<h2>Using ZigPC in a multiprotocol configuration<a class="headerlink" href="#using-zigpc-in-a-multiprotocol-configuration" title="Permalink to this heading"></a></h2>
<p>The ZigPC is an EZSP-based gateway application and can be run in a
multiprotocol environment. Please see <a class="reference internal" href="../../doc/getting_started_multiprotocol_cpc.html"><span class="doc std std-doc">Multiprotocol Setup</span></a>
for details about the multiprotocol stack.</p>
<p>In summary, the radio should be configured as an RCP, as opposed to a standard
Zigbee NCP. The CPCd application should run and point to the RCP. If encryption
is enabled, please follow the guide above, but the encryption key will need to
be flashed to the radio.</p>
<p>Once properly setup, <a class="reference internal" href="../zigbeed/readme_user.html"><span class="doc std std-doc">Zigbeed</span></a> is required to run.
By default, it points to the 1st CPCd radio URL. If installing Zigbeed through
Unify, a port will be opened at /dev/ttyZigbeeNCP which will forward all EZSP
messages to the Zigbeed application.</p>
<p>After Zigbeed and CPCd are both properly set up, ZigPC can then be started
and used in a multiprotocol context by pointing ‘–zigpc.serial’ at the virtual
USB port (/dev/ttyZigbeeNCP) created in the previous step.</p>
<p>The user can then configure the other protocols alongside ZigPC to run many
protocols using the same radio.</p>
<section id="note">
<h3>NOTE<a class="headerlink" href="#note" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>By default, the ZigPC is configured for a singe protocol environment
Therefore, the ZigPC will point to the same USB port as the CPCd
application.
When running ZigPC in a multiprotocol context, the serial port should be
changed to avoid this conflict.
</pre></div>
</div>
</section>
</section>
<section id="understanding-zigpc-functions">
<h2>Understanding ZigPC Functions<a class="headerlink" href="#understanding-zigpc-functions" title="Permalink to this heading"></a></h2>
<p>The Zigbee Protocol Controller performs network discovery and device servicing for sleepy and non-sleepy Zigbee devices. The following section outline some of the different functions ZigPC performs.</p>
<section id="device-addressing">
<h3>Device Addressing<a class="headerlink" href="#device-addressing" title="Permalink to this heading"></a></h3>
<p>Unify uses a unique identifier when addressing nodes included by different protocol
controllers called a Unified Node Identifier (UNID). ZigPC uses the Extended Unique Identifier of the device (EUI64) as part of the UNID to relay messages between Unify and Zigbee devices: <code class="docutils literal notranslate"><span class="pre">zb-&lt;EUI64_IN_BIG_ENDIAN&gt;</span></code></p>
<p>For example, if the EUI64 of a device is <code class="docutils literal notranslate"><span class="pre">00-11-22-33-44-55-66-77</span></code>, the UNID will be: <code class="docutils literal notranslate"><span class="pre">zb-0011223344556677</span></code></p>
</section>
<section id="zigbee-node-commissioning">
<h3>Zigbee Node Commissioning<a class="headerlink" href="#zigbee-node-commissioning" title="Permalink to this heading"></a></h3>
<p>ZigPC currently only supports adding Zigbee devices using the Unify SmartStart
List functionality. The currently supported format recognized by ZigPC is
the Z3 Install Codes based Device-Specific key (DSK). See Unify Specification Section
3.7.1 for more details.</p>
<section id="z3-install-code-based-provisioning">
<h4>Z3 Install Code-Based Provisioning<a class="headerlink" href="#z3-install-code-based-provisioning" title="Permalink to this heading"></a></h4>
<p>The Unify SmartStart List enables easily adding pre-provisioned devices to
the network using a protocol-specific Device-Specific Key (DSK). The SmartStart
List is managed by another Unify component called uic-upvl.</p>
<p>Currently, ZigPC uses DSKs that contain information from the out-of-band Zigbee
3.0 Installation Code method to permit a Zigbee device to join the network.</p>
<p><b>DSK Format:</b></p>
<p>ZigPC Accepts SmartStart entries that have the following DSK format in groups of
two hexadecimal values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">END_DEVICE_EUI64</span><span class="o">&gt;-&lt;</span><span class="n">END_DEVICE_INSTALL_CODE</span><span class="o">&gt;-&lt;</span><span class="n">END_DEVICE_INSTALL_CODE_CRC</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, if the Zigbee device EUI64 (big endian) is 0x00 0xAA 0x11 0xBB 0x22
0xCC 0x33 0xDD and the install code (big endian) is 0x0A 0x0B 0x0C 0x0D 0xE 0xF
0x1 0x2 with a CRC of 0x7B8A, the DSK should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">00</span><span class="o">-</span><span class="n">AA</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">BB</span><span class="o">-</span><span class="mi">22</span><span class="o">-</span><span class="n">CC</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="n">DD</span><span class="o">-</span><span class="mi">0</span><span class="n">A</span><span class="o">-</span><span class="mi">0</span><span class="n">B</span><span class="o">-</span><span class="mi">0</span><span class="n">C</span><span class="o">-</span><span class="mi">0</span><span class="n">D</span><span class="o">-</span><span class="mf">0E-0</span><span class="n">F</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">7</span><span class="n">B</span><span class="o">-</span><span class="mi">8</span><span class="n">A</span>
</pre></div>
</div>
<p>After a Z3 Install code-based SmartStart DSK has been recognized in the Unify
published SmartStart List, ZigPC will extract and add the Install Code and
EUI64 pair to ZigPC. When network-steering is performed on the joining node,
ZigPC will validate using the Install Code based Link key extracted and allow
the device to join the network.</p>
<p>See (AN1089: Using Installation Codes with
Zigbee Devices)[<a class="reference external" href="https://www.silabs.com/documents/public/application-notes/an1089-using-installation-codes-with-zigbee-devices.pdf">https://www.silabs.com/documents/public/application-notes/an1089-using-installation-codes-with-zigbee-devices.pdf</a>]
for more details on how to setup Z3 Install Codes on joining devices.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Subscribing to the current list of SmartStart entries: <code class="docutils literal notranslate"><span class="pre">ucl/SmartStart/List</span></code></p></li>
</ul>
</section>
<section id="well-known-key-based-provisioning">
<h4>Well-Known-Key Based Provisioning<a class="headerlink" href="#well-known-key-based-provisioning" title="Permalink to this heading"></a></h4>
<p>The ZigPC network can be configured to accept device joins using the well-known
key. ZigPC will open up the network and allow well-known key based joins when
the NetworkManagement state <code class="docutils literal notranslate"><span class="pre">add</span> <span class="pre">node</span></code> is requested:</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Subscribing to Network Management state change requests:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ProtocolController/NetworkManagement/Write</span></code></p></li>
<li><p>Publishing Network Management state changes:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ProtocolController/NetworkManagement</span></code></p></li>
</ul>
</section>
</section>
<section id="device-state-updates">
<h3>Device State Updates<a class="headerlink" href="#device-state-updates" title="Permalink to this heading"></a></h3>
<p>ZigPC publishes the network status of devices through inclusion, interview,
and regular function stages.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Publishing device state updates:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/State</span></code></p></li>
<li><p>Publishing endpoints active under device:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/State/Attributes/EndpointIdList/Reported</span></code></p></li>
</ul>
</section>
<section id="device-discovery">
<h3>Device Discovery<a class="headerlink" href="#device-discovery" title="Permalink to this heading"></a></h3>
<p>Once added to the network, ZigPC performs device interviewing to retrieve the
ZCL clusters supported per each endpoint on the device. After the device
interview process finishes, bindings and attribute reports are configured to
publish attribute updates to Unify. In addition, ZigPC publishes the commands
supported by these ZCL clusters as UCL clusters.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Publishing supported commands for UCL clusters discovered:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ep&lt;ENDPOINT_ID&gt;/&lt;CLUSTER_NAME&gt;/SupportedCommands</span></code></p></li>
</ul>
</section>
<section id="device-command-relaying">
<h3>Device Command Relaying<a class="headerlink" href="#device-command-relaying" title="Permalink to this heading"></a></h3>
<p>After the supported commands are published by ZigPC for a device endpoint, UCL
commands can be sent to the Zigbee device. The UCL command received by ZigPC
is mapped to a corresponding ZCL command and sent to the Zigbee device endpoint.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Subscribing to UCL cluster commands sent by Unify gateway:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ep&lt;ENDPOINT_ID&gt;/&lt;CLUSTER_NAME&gt;/Commands/&lt;COMMAND_NAME&gt;</span></code></p></li>
</ul>
</section>
<section id="device-generatedcommand-updates">
<h3>Device GeneratedCommand Updates<a class="headerlink" href="#device-generatedcommand-updates" title="Permalink to this heading"></a></h3>
<p>ZigPC is able to publish commands generated by devices (either as command
responses or as unsolicted stimuli) to the Unify broer. The ZCL command is
parsed and mapped to UCL command before publishing under the device, endpoint,
cluster combination.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Publishing to UCL cluster generated commands received to Unify gateway:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ep&lt;ENDPOINT_ID&gt;/&lt;CLUSTER_NAME&gt;/GeneratedCommands/&lt;COMMAND_NAME&gt;</span></code></p></li>
</ul>
</section>
<section id="device-attribute-updates">
<h3>Device Attribute Updates<a class="headerlink" href="#device-attribute-updates" title="Permalink to this heading"></a></h3>
<p>Zigbee devices with attribute reporting configured will send ZigPC attribute reports for each attribute supported in each ZCL cluster under each endpoint. These attribute updates are published under the UCL <code class="docutils literal notranslate"><span class="pre">Reported</span></code> topic when changes occur of after a timeout.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Publishing reported UCL cluster attribute updates:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ep&lt;ENDPOINT_ID&gt;/&lt;CLUSTER_NAME&gt;/Attributes/&lt;ATTRIBUTE_NAME&gt;/Reported</span></code></p></li>
</ul>
<p>To disable bindings and reporting between end devices and the protocol controller, run zigpc with the
‘–zigpc.poll_attr_only’ flag at runtime.
This flag forces the protocol controller to poll endpoints using a ‘ReadAttributes’ command
at a set interval (500ms by default).
In this configuration, sending a ‘ForceReadAttributes’ MQTT message can also request the specific
attributes desired from an endpoint.</p>
</section>
<section id="group-message-handling">
<h3>Group Message Handling<a class="headerlink" href="#group-message-handling" title="Permalink to this heading"></a></h3>
<p>Unify uses the ZCL Group ID format to send group commands to multiple devices
spanning different protocols at the same time. ZigPC uses the ZCL Groups
cluster functionality on each Zigbee endpoint to maintain the group membership.
After an endpoint is added to the group using the UCL Groups/AddGroup
command, ZigPC publishes the list of groups the endpoint is part of.</p>
<p>ZigPC uses the functionality provided by the Unify Group manager component
called uic-gms. Once the group list is published by ZigPC, the uic-gms
manages the group commands that can be sent through the Unify gateway.</p>
<p>ZigPC listens to the by-group topic space and services any groupIDs that is
recognized by translating the UCL cluster command and sending this message as
a multicast message to the Zigbee network.</p>
<p>UCL topics used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ucl/by-group/&lt;GROUP_ID&gt;/&lt;CLUSTER_NAME&gt;/Commands/&lt;COMMAND_NAME&gt;</span></code></p>
<ul>
<li><p>Behavior: ZigPC listens to DotDot cluster commands received and sends the
group command as a multicast message on the network based on Unify Spec Section
6.3.3.</p></li>
</ul>
</li>
</ul>
</section>
<section id="zigbee-ota-firmware-upgrade-support">
<h3>Zigbee OTA Firmware Upgrade Support<a class="headerlink" href="#zigbee-ota-firmware-upgrade-support" title="Permalink to this heading"></a></h3>
<p>ZigPC supports OTA updates for nodes that have an OTA ZCL cluster.
The OTA mechanism is based off the existing GSDK, OTA-Server plugin.
For more information, see <a class="reference external" href="https://www.silabs.com/documents/public/application-notes/an728-ota-client-server-setup.pdf">Silicon Labs’ OTA Server-Client Application
Note</a>.</p>
<p>NOTE: It is expected that a device will have a bootloader to properly support OTA updates. See
[Silicon Labs’ Bootloader User Guide](<a class="reference external" href="https://www.silabs.com/documents/public/user-guides">https://www.silabs.com/documents/public/user-guides</a> ug103-06-fundamentals-bootloading.pdf)
for more details.</p>
</section>
<section id="zigbee-sleepy-end-device-support">
<h3>Zigbee Sleepy End Device Support<a class="headerlink" href="#zigbee-sleepy-end-device-support" title="Permalink to this heading"></a></h3>
<p>ZigPC handles sleepy end device (SED) communications with the use of the ZCL
PollControl server functionality available on the SED. After the SED is
interviewed by ZigPC, ZCL messages sent to SED will be stored until the SED
PollControl server sends ZigPC a PollControl/CheckIn message. ZigPC will send
a PollControl/CheckInrResponse as a reply to transition SED into fast-polling
mode. This will allow ZigPC to unload/send any queued messages to the SED.</p>
</section>
<section id="protocol-controller-diagnostics">
<h3>Protocol Controller Diagnostics<a class="headerlink" href="#protocol-controller-diagnostics" title="Permalink to this heading"></a></h3>
<p>ZigPC publishing information related to the host process and NCP information to
provide usage statistics to customers. The following metrics are being published
currently:</p>
<ul class="simple">
<li><p>System uptime</p></li>
<li><p>System CPU load average</p></li>
<li><p>Process CPU usage</p></li>
<li><p>Process memory usage</p></li>
<li><p>Zigbee stack counters</p></li>
</ul>
<p>UCL topics used:</p>
<ul class="simple">
<li><p>Publishing supported diagnostic metrics:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ProtocolController/SystemHealth/SupportedMetrics</span></code></p></li>
<li><p>Subscribing to metric requests:
<code class="docutils literal notranslate"><span class="pre">ucl/by-unid/&lt;DEVICE_UNID&gt;/ProtocolController/SystemHealth/Request</span></code></p></li>
</ul>
</section>
<section id="updating-ncp-firmware">
<h3>Updating NCP Firmware<a class="headerlink" href="#updating-ncp-firmware" title="Permalink to this heading"></a></h3>
<p>The Zigbee Protocol Controller has the capability of updating the
NCP radio it uses. In the configuration (either YAML file or command
line argument, see configuration section for details), enable the
“–zigpc.ncp_update” flag and set the “–zigpc.ncp_firmware_path”
appropriately. The Protocol Controller will startup and
automatically update the NCP with specified firmware. Run zigpc in
debug mode to show progress updates.</p>
<p><br><br></p>
</section>
</section>
<section id="getting-started-with-including-zigbee-3-0-device-to-zigpc">
<h2>Getting Started with Including Zigbee 3.0 Device to ZigPC<a class="headerlink" href="#getting-started-with-including-zigbee-3-0-device-to-zigpc" title="Permalink to this heading"></a></h2>
<p>For the following example, the UNID addresses used are as follows:</p>
<p><strong>ZigPC Gateway UNID: zb-AAAAAAAAAAAAAAAA</strong></p>
<p><strong>Zigbee Device UNID: zb-0102030405060708</strong></p>
<p>There are 3 command-lines terminals used in the following steps:</p>
<ol class="arabic simple">
<li><p>Non-ARM Host prompt: Host&gt; (used in Simplicity Commander instructions)</p></li>
<li><p>Raspberry Pi prompt: RaspberryPi&gt;</p></li>
<li><p>Zigbee Device EmberCLI prompt: Z3Device&gt;</p></li>
</ol>
<p>OPTIONAL: To see all messages sent to the broker, follow the steps to download
and install the <a class="reference external" href="https://mqtt-explorer.com/">MQTT Explorer tool</a>. After it is
run on the host machine, connect to the MQTT broker on the Raspberry Pi.</p>
<p>To perform the below steps using the Unify Dev GUI tool, see
<a class="reference internal" href="../dev_ui/dev_gui/readme_user.html"><span class="doc std std-doc">Dev GUI User Guide</span></a>.</p>
<section id="adding-zigbee-device-to-the-zigpc-network-via-install-code-method">
<h3>Adding Zigbee Device to the ZigPC Network via Install-Code Method<a class="headerlink" href="#adding-zigbee-device-to-the-zigpc-network-via-install-code-method" title="Permalink to this heading"></a></h3>
<p>NOTE: The following steps use the command line interface (CLI) exposed by Simplicity
Commander stand-alone tool.</p>
<ol class="arabic">
<li><p>Create a random HEX sequence of 6,8,12, or 16 bytes (12, 16, 24, 32
characters respectively) and put it in a file containing the following text:
<code class="docutils literal notranslate"><span class="pre">Install</span> <span class="pre">Code:</span> <span class="pre">&lt;RANDOM_HEX_SEQUENCE&gt;</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Host&gt; cat /tmp/install-code.txt:

Install Code: F64C3E6D196569CE4F2000A40069B534
</pre></div>
</div>
</li>
<li><p>Connect the Zigbee device to your host machine via USB.</p></li>
<li><p>Use the Simplicity Commander CLI to flash the Install code to the Zigbee Device:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Host&gt; commander flash --tokengroup znet --tokenfile /tmp/install-code.txt --device efr32mg12p
</pre></div>
</div>
</li>
<li><p>Validate the install code is present and extract the CRC corresponding to the
install code by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Host&gt; commander tokendump –-tokengroup znet –-device efr32mg12p

<span class="c1">## sample output ##</span>
<span class="c1"># ...</span>
<span class="c1"># # MFG_EMBER_EUI_64              : 0807060504030201       &lt;-- NOTE: This is in Little Endian</span>
<span class="c1"># ...</span>
<span class="c1"># #&#39;MFG_INSTALLATION_CODE (Smart Energy Install Code)&#39; token group</span>
<span class="c1"># # Install Code Flags : 0x0006</span>
<span class="c1"># Install Code       : F64C3E6D196569CE4F2000A40069B534    &lt;-- NOTE: This is in Big Endian</span>
<span class="c1"># # CRC                : 0x7646                            &lt;-- NOTE: This is in Little Endian</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p><em>NOTE: Ensure ZigPC is running by this step.</em></p>
</div></blockquote>
<ol class="arabic" start="5">
<li><p>Format the SmartStart DSK using the Z3Device’s EUI64, install code, and
install code CRC.</p>
<ul class="simple">
<li><p>Example EUI64 in big endian = <code class="docutils literal notranslate"><span class="pre">01-02-03-04-05-06-07-08</span></code></p></li>
<li><p>Install code in big endian =
<code class="docutils literal notranslate"><span class="pre">F6-4C-3E-6D-19-65-69-CE-4F-20-00-A4-00-69-B5-34</span></code></p></li>
<li><p>Install code CRC  big endian = <code class="docutils literal notranslate"><span class="pre">46-76</span></code></p></li>
<li><p>DSK combining above information =
<code class="docutils literal notranslate"><span class="pre">01-02-03-04-05-06-07-08-F6-4C-3E-6D-19-65-69-CE-4F-20-00-A4-00-69-B5-34-46-76</span></code></p></li>
</ul>
<p>NOTE: Ensure the EUI64 used above corresponds to the device that is
joining, not the example EUI64 used as an example`.</p>
</li>
<li><p>Access the Zigbee device EmberCLI using Studio or a serial terminal to perform cleanup of the device state.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Z3Device&gt; plugin reporting clear
Z3Device&gt; plugin groups clear
Z3Device&gt; network leave
Z3Device&gt; keys clear
</pre></div>
</div>
<p>NOTE: Ensure that Z3Device is not part of the network by entering the
<code class="docutils literal notranslate"><span class="pre">info</span></code> command and seeing <code class="docutils literal notranslate"><span class="pre">panID</span> <span class="pre">[0x0000]</span></code> and <code class="docutils literal notranslate"><span class="pre">nodeID</span> <span class="pre">[0xFFFE]</span></code> in the
output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Z3Device&gt; info

<span class="c1">## sample output ##</span>
<span class="c1"># MFG String:</span>
<span class="c1"># AppBuilder MFG Code: 0x1002</span>
<span class="c1"># node [(&gt;)0102030405060708] chan [0] pwr [0]</span>
<span class="c1"># panID [0x0000] nodeID [0xFFFE] xpan [0x(&gt;)0000000000000000]</span>
<span class="c1"># parentID [0x0000] parentRssi [0]</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><p>Validate that a new MQTT topic has been published showing the Protocol
Controller Network Management state as <code class="docutils literal notranslate"><span class="pre">idle</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/+/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;idle&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;], &quot;RequestedStateParameters&quot;: []}</span>
</pre></div>
</div>
<p>in the output above, the ZigPC Gateway UNID can be seen from the topic
as <code class="docutils literal notranslate"><span class="pre">zb-AAAAAAAAAAAAAAAA</span></code></p>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab to see the Protocol Controller UNID and state.</p>
<p><img alt="" src="../../_images/user_guide-devgui-nodes-init.png" /></p>
</li>
<li><p>Use the Mosquitto publish tool to add a SmartStart entry using the DSK
created above.</p>
<p>OPTIONAL: you can also specify the EUI64 of the ZigPC Gateway NCP (see
User Manual below) in the “ProtocolControllerUnid” field:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/SmartStart/List/Update&#39;</span> -m <span class="s1">&#39;{&quot;DSK&quot;:&quot;01-02-03-04-05-06-07-08-F6-4C-3E-6D-19-65-69-CE-4F-20-00-A4-00-69-B5-34-46-76&quot;,&quot;Include&quot;:true,&quot;ProtocolControllerUnid&quot;:&quot;&quot;,&quot;Unid&quot;:&quot;&quot;}&#39;</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the SmartStart tab and click on the “Add” key</p>
<p><img alt="" src="../../_images/user_guide-devgui-smartstart-new.png" /></p>
<p><strong>Dev GUI Method</strong>: Fill in the DSK in the entry.</p>
<p><img alt="" src="../../_images/user_guide-devgui-smartstart-dsk-add.png" /></p>
</li>
<li><p>Once ZigPC detects the new SmartStart entry, it will open the network to permit the Z3Device to
join using the install code configured.</p></li>
<li><p>In the Z3Device, start the Network Steering plugin process by entering <code class="docutils literal notranslate"><span class="pre">plugin</span> <span class="pre">network-steering</span> <span class="pre">start</span> <span class="pre">0</span></code> on the Z3Device Ember CLI:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Z3Device&gt; plugin network-steering start <span class="m">0</span>
</pre></div>
</div>
<ol class="arabic simple" start="11">
<li><p>Z3Device should join the ZigPC network and assign a UNID using the
following format: <code class="docutils literal notranslate"><span class="pre">zb-&lt;Z3DEVICE_EUI64_BE&gt;</span></code>.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## Sample format ##</span>
<span class="c1"># Z3Device EUI64(BE): 0102030405060708</span>
<span class="c1"># Z3Device UNID: zb-0102030405060708</span>
</pre></div>
</div>
<ol class="arabic simple" start="12">
<li><p>Validate that the UNID has been assigned by checking the Unify SmartStart list
using the Mosquitto subscribe tool:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/SmartStart/List&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/SmartStart/List { &quot;value&quot;: [{&quot;DSK&quot;:&quot;01-02-03-04-05-06-07-08-F6-4C-3E-6D-19-65-69-CE-4F-20-00-A4-00-69-B5-34-46-76&quot;,&quot;Include&quot;:true,&quot;ProtocolControllerUnid&quot;:&quot;&quot;,&quot;Unid&quot;:&quot;zb-0102030405060708&quot;}] }</span>
</pre></div>
</div>
<p>As seen, the Device UNID is “zb-0102030405060708”.</p>
<p><strong>Dev GUI Method</strong>: Go to the SmartStart tab and see the updated UNID field.</p>
<p><img alt="" src="../../_images/user_guide-devgui-smartstart-dsk-used.png" /></p>
<ol class="arabic simple" start="13">
<li><p>Validate that the ZigPC NetworkManagement state has transitioned back to
idle (previous MQTT messages would have shown the NetworkManagement state
has transitioned from “idle” -&gt; “add node” -&gt; “node interview” -&gt; “idle”):</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/+/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;idle&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;, &quot;node interview&quot;], &quot;RequestedStateParameters&quot;: []}</span>
</pre></div>
</div>
<ol class="arabic simple" start="14">
<li><p>Validate that a new MQTT topic has been published showing Z3Device is online and functional:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/State&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/State { &quot;Security&quot;: &quot;Zigbee Z3.0&quot;, &quot;MaximumCommandDelay&quot;: &quot;1&quot;, &quot;NetworkStatus&quot;: &quot;Online functional&quot; }</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab and see the updated Z3Device entry.</p>
<p><img alt="" src="../../_images/user_guide-devgui-nodes-included.png" /></p>
</section>
<section id="adding-zigbee-device-to-the-zigpc-network-using-well-known-key">
<h3>Adding Zigbee Device to the ZigPC Network using Well-Known Key<a class="headerlink" href="#adding-zigbee-device-to-the-zigpc-network-using-well-known-key" title="Permalink to this heading"></a></h3>
<p>NOTE: The following steps use the command line interface (CLI) exposed by Simplicity
Commander stand-alone tool.</p>
<ol class="arabic simple">
<li><p>Configure and run ZigPC to allow accepting well-known key based joins:</p></li>
</ol>
<ul class="simple">
<li><p>Using CLI with argument <code class="docutils literal notranslate"><span class="pre">--zigpc.tc_use_well_known_key</span> <span class="pre">true</span></code></p></li>
<li><p>Using system service configuration in <code class="docutils literal notranslate"><span class="pre">etc/uic/uic.cfg</span></code>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">zigpc</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">tc_use_well_known_key</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Validate the following MQTT topic has been published showing the Protocol
Controller Network Management state as <code class="docutils literal notranslate"><span class="pre">idle</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/+/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;idle&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;], &quot;RequestedStateParameters&quot;: []}</span>
</pre></div>
</div>
<p>in the output above, the ZigPC Gateway UNID can be seen from the topic
as <code class="docutils literal notranslate"><span class="pre">zb-AAAAAAAAAAAAAAAA</span></code></p>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab to see the Protocol Controller UNID and state.</p>
<p><img alt="" src="../../_images/user_guide-devgui-nodes-init.png" /></p>
</li>
<li><p>Use the Mosquitto publish tool to request a Network Management state change to <code class="docutils literal notranslate"><span class="pre">add</span> <span class="pre">node</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement/Write&#39;</span> -m <span class="s1">&#39;{&quot;State&quot;: &quot;add node&quot;}&#39;</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab and click on the “States” dropdown and select the “add node” item.</p>
<p><img alt="" src="../../_images/user_guide-devgui-netmgmt-add-node.png" /></p>
<p>ZigPC will now open the network to permit the Z3Device to join using the well-known key.</p>
</li>
<li><p>In the Z3Device, start the Network Steering plugin process by entering <code class="docutils literal notranslate"><span class="pre">plugin</span> <span class="pre">network-steering</span> <span class="pre">start</span> <span class="pre">0</span></code> on the Z3Device Ember CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Z3Device&gt; plugin network-steering start <span class="m">0</span>
</pre></div>
</div>
</li>
<li><p>Z3Device should join the ZigPC network and assign a UNID using the
following format: <code class="docutils literal notranslate"><span class="pre">zb-&lt;Z3DEVICE_EUI64_BE&gt;</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## Sample format ##</span>
<span class="c1"># Z3Device EUI64(BE): 0102030405060708</span>
<span class="c1"># Z3Device UNID: zb-0102030405060708</span>
</pre></div>
</div>
</li>
<li><p>Validate that the ZigPC NetworkManagement state has transitioned back to
idle (previous MQTT messages would have shown the NetworkManagement state
has transitioned from “idle” -&gt; “add node” -&gt; “node interview” -&gt; “idle”):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/+/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;idle&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;, &quot;node interview&quot;], &quot;RequestedStateParameters&quot;: []}</span>
</pre></div>
</div>
</li>
<li><p>Validate that a new MQTT topic has been published showing Z3Device is online and functional:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/State&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/State { &quot;Security&quot;: &quot;Zigbee Z3.0&quot;, &quot;MaximumCommandDelay&quot;: &quot;1&quot;, &quot;NetworkStatus&quot;: &quot;Online functional&quot; }</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab and see the updated Z3Device entry.</p>
<p><img alt="" src="../../_images/user_guide-devgui-nodes-included.png" /></p>
</li>
</ol>
</section>
<section id="discovering-ucl-cluster-command-support-for-z3device">
<h3>Discovering UCL Cluster Command Support for Z3Device<a class="headerlink" href="#discovering-ucl-cluster-command-support-for-z3device" title="Permalink to this heading"></a></h3>
<p>NOTE: The Zigbee device must be added using the SmartStart addition process
discussed above.
NOTE: ZigPC will publish the UCL cluster command support under for all endpoints
discovered in the interview process.</p>
<ol class="arabic">
<li><p>Subscribe to the UCL cluster command topic space under a Z3Device endpoint:
NOTE: Endpoint 1 (ep1) chosen for this example. Other endpoint support will
be published based on device discovery</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/+/SupportedCommands&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/SupportedCommands</span>
<span class="c1"># {&quot;value&quot;: [&quot;Off&quot;,&quot;On&quot;,&quot;Toggle&quot;,&quot;OffWithEffect&quot;,&quot;OnWithRecallGlobalScene&quot;,&quot;OnWithTimedOff&quot;,&quot;WriteAttributes&quot;,&quot;ForceReadAttributes&quot;]}</span>
<span class="c1">#</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Level/SupportedCommands</span>
<span class="c1"># {&quot;value&quot;: [&quot;MoveToLevel&quot;,&quot;Move&quot;,&quot;Step&quot;,&quot;Stop&quot;,&quot;MoveToLevelWithOnOff&quot;,&quot;MoveWithOnOff&quot;,&quot;StepWithOnOff&quot;,&quot;StopWithOnOff&quot;,&quot;MoveToClosestFrequency&quot;,&quot;WriteAttributes&quot;,&quot;ForceReadAttributes&quot;]}</span>
<span class="c1">#</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Identify/SupportedCommands</span>
<span class="c1"># {&quot;value&quot;: [&quot;Identify&quot;,&quot;IdentifyQuery&quot;,&quot;TriggerEffect&quot;,&quot;WriteAttributes&quot;,&quot;ForceReadAttributes&quot;]}</span>
<span class="c1">#</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Groups/SupportedCommands</span>
<span class="c1"># {&quot;value&quot;: [&quot;AddGroup&quot;,&quot;ViewGroup&quot;,&quot;GetGroupMembership&quot;,&quot;RemoveGroup&quot;,&quot;RemoveAllGroups&quot;,&quot;AddGroupIfIdentifying&quot;,&quot;WriteAttributes&quot;,&quot;ForceReadAttributes&quot;]}</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the Nodes tab and see <code class="docutils literal notranslate"><span class="pre">Type</span></code> column to see the supported clusters.</p>
<p><img alt="" src="../../_images/user_guide-devgui-nodes-included.png" /></p>
</li>
</ol>
</section>
<section id="discovering-ucl-cluster-attribute-updates-for-z3device">
<h3>Discovering UCL Cluster Attribute Updates for Z3Device<a class="headerlink" href="#discovering-ucl-cluster-attribute-updates-for-z3device" title="Permalink to this heading"></a></h3>
<p>NOTE: The Zigbee device must be added using the SmartStart addition process
discussed above.
NOTE: ZigPC will publish the UCL cluster support under for all endpoints
discovered in the interview process.</p>
<ol class="arabic">
<li><p>Subscribe to the UCL cluster attribute topic space under one of the Z3Device
endpoints:
NOTE: Endpoint 1 (ep1) chosen for this example. Other endpoint support will
be published based on device discovery.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/+/Attributes/#&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/GlobalSceneControl/Reported { &quot;value&quot;: true }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnOff/Reported { &quot;value&quot;: false }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnTime/Reported { &quot;value&quot;: 0 }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OffWaitTime/Reported { &quot;value&quot;: 0 }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/StartUpOnOff/Reported { &quot;value&quot;: &quot;SetOnOffTo0&quot; }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/ClusterRevision/Reported {&quot;value&quot;: 2}</span>
<span class="c1">#</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Level/Attributes/CurrentLevel/Reported { &quot;value&quot;: 0 }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Level/Attributes/RemainingTime/Reported { &quot;value&quot;: 0 }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Level/Attributes/StartUpCurrentLevel/Reported { &quot;value&quot;: 0 }</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/Level/Attributes/ClusterRevision/Reported {&quot;value&quot;: 2}</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to a specific cluster tab (i.e. OnOff) see the main attribute <code class="docutils literal notranslate"><span class="pre">State</span></code> column.</p>
<p><img alt="" src="../../_images/user_guide-devgui-onoff-discovery.png" /></p>
</li>
</ol>
</section>
<section id="sending-a-ucl-cluster-command-to-z3device-to-see-attribute-update">
<h3>Sending a UCL Cluster Command to Z3Device to see Attribute Update<a class="headerlink" href="#sending-a-ucl-cluster-command-to-z3device-to-see-attribute-update" title="Permalink to this heading"></a></h3>
<p>The UCL command format translates 1:1 to ZCL messages that is recognized by ZCL
compliant Zigbee devices. To know the exact format of the UCL command, see
the Unify specification and the DotDot specification.</p>
<ol class="arabic">
<li><p>See the supported commands for a UCL cluster. For this exercise, the endpoint 1, OnOff cluster will be selected.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/OnOff/SupportedCommands&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/SupportedCommands {&quot;value&quot;: [&quot;Off&quot;,&quot;On&quot;,&quot;Toggle&quot;,&quot;OffWithEffect&quot;,&quot;OnWithRecallGlobalScene&quot;,&quot;OnWithTimedOff&quot;,&quot;WriteAttributes&quot;,&quot;ForceReadAttributes&quot;]}</span>
</pre></div>
</div>
<p>The commands can be send to the Z3Device/ep1/OnOff cluster: <code class="docutils literal notranslate"><span class="pre">Off,</span> <span class="pre">On,</span> <span class="pre">Toggle,</span> <span class="pre">OffWithEffect,</span> <span class="pre">OnWithRecallGlobalScene,</span> <span class="pre">OnWithTimedOff,</span> <span class="pre">WriteAttributes,</span> <span class="pre">ForceReadAttributes</span></code></p>
</li>
<li><p>Publish a UCL command to send to the Z3Device endpoint’s OnOff cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## sample output based on choosing to send the OnOff/Toggle command ##</span>
<span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/OnOff/Commands/Toggle&#39;</span> -m <span class="s1">&#39;{}&#39;</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the OnOff tab and click on the <code class="docutils literal notranslate"><span class="pre">Toggle</span></code> Command on the ep1 row.</p>
</li>
<li><p>On the Z3Device device, notice that a ZCL message has been received:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Z3Device&gt;

<span class="c1">## sample output ##</span>
<span class="c1"># T00000000:RX len 3, ep 01, clus 0x0006 (On/off) FC 01 seq 1A cmd 02 payload[]</span>
</pre></div>
</div>
</li>
<li><p>Subscribe to the UCL OnOff Attribute in the OnOff cluster to see the updated
reported state:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnOff/Reported&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnOff/Reported { &quot;value&quot;: true }</span>
</pre></div>
</div>
<p><strong>Dev GUI Method</strong>: Go to the OnOff tab and see the OnOff <code class="docutils literal notranslate"><span class="pre">State</span></code> icon is active.</p>
<p><img alt="" src="../../_images/user_guide-devgui-onoff-toggle.png" /></p>
</li>
<li><p>Retry the same UCL command to send to the Z3Device endpoint’s OnOff cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## sample output based on choosing to send the OnOff/Toggle command ##</span>
<span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/OnOff/Commands/Toggle&#39;</span> -m <span class="s1">&#39;{}&#39;</span>
</pre></div>
</div>
</li>
<li><p>On the Z3Device device, notice that a ZCL message has been received:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Z3Device&gt;

<span class="c1">## sample output ##</span>
<span class="c1"># T00000000:RX len 3, ep 01, clus 0x0006 (On/off) FC 01 seq 1B cmd 02 payload[]</span>
</pre></div>
</div>
</li>
<li><p>Subscribe to the UCL OnOff Attribute in the OnOff cluster to see the updated
reported state:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -W <span class="m">1</span> -v -t <span class="s1">&#39;ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnOff/Reported&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-0102030405060708/ep1/OnOff/Attributes/OnOff/Reported { &quot;value&quot;: false }</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="removing-a-device-already-in-the-zigpc-network">
<h3>Removing a Device Already in the ZigPC Network<a class="headerlink" href="#removing-a-device-already-in-the-zigpc-network" title="Permalink to this heading"></a></h3>
<p>NOTE: The Zigbee device must be added using the SmartStart addition process
discussed above.</p>
<ol class="arabic">
<li><p>Send a Network Management state change to start removing a node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement/Write&#39;</span> -m <span class="s1">&#39;{&quot;State&quot;: &quot;remove node&quot;}&#39;</span>
</pre></div>
</div>
</li>
<li><p>ZigPC will try to perform a state change. If successful, the following
message will be published:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;remove node&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;, &quot;node interview&quot;], &quot;RequestedStateParameters&quot;: [&quot;Unid&quot;]}</span>
</pre></div>
</div>
<p>As seen above, ZigPC requests that the UNID parameter should be passed in.</p>
</li>
<li><p>Send the UNID of the Z3Device to remove:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement/Write&#39;</span> -m <span class="s1">&#39;{&quot;State&quot;: &quot;remove node&quot;, &quot;StateParameters&quot;: {&quot;Unid&quot;: &quot;zb-0102030405060708&quot;}}&#39;</span>
</pre></div>
</div>
</li>
<li><p>Validate that the Z3Device has left the network by entering
<code class="docutils literal notranslate"><span class="pre">info</span></code> on the Ember CLI and noticing a nodeID of 0xFFFE:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
Z3Device&gt; info

<span class="c1">## sample output ##</span>
<span class="c1"># MFG String:</span>
<span class="c1"># AppBuilder MFG Code: 0x1002</span>
<span class="c1"># node [(&gt;)0102030405060708] chan [0] pwr [0]</span>
<span class="c1"># panID [0x0000] nodeID [0xFFFE] xpan [0x(&gt;)0000000000000000]</span>
<span class="c1"># parentID [0x0000] parentRssi [0]</span>
<span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><p>Validate that the NetworkManagement topic has shown the state transition
from “remove node” to “idle”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/+/ProtocolController/NetworkManagement&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/NetworkManagement {&quot;State&quot;: &quot;idle&quot;, &quot;SupportedStateList&quot;: [&quot;add node&quot;, &quot;remove node&quot;, &quot;node interview&quot;], &quot;RequestedStateParameters&quot;: []}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="updating-zigbee-device-firmware-already-on-the-zigpc-network">
<h3>Updating Zigbee Device Firmware already on the ZigPC Network<a class="headerlink" href="#updating-zigbee-device-firmware-already-on-the-zigpc-network" title="Permalink to this heading"></a></h3>
<p>To initialize an OTA update, you need the following:</p>
<ul class="simple">
<li><p>A working end-device with a ZCL OTA client cluster enabled.</p></li>
<li><p>A valid firmware file to upload to the device - refer to the application note above.</p></li>
<li><p>Sufficient storage space on both host and end device for the firmware image.</p></li>
<li><p>(Optional) An ota-files directory created in the location where the ZigPC will be run.</p></li>
</ul>
<section id="instructions-on-how-to-start-an-ota-update">
<h4>Instructions on how to start an OTA update<a class="headerlink" href="#instructions-on-how-to-start-an-ota-update" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>Run the Zigbee Protocol Controller, as specified above in this document</p></li>
<li><p>Verify that the ‘ota-files’ directory exists. This path can be manually passed in
If this folder was not created by the user,
the Zigbee Protocol Controller should create it at startup.</p></li>
<li><p>Add a Zigbee node, as described above in [Adding Z3Light Device to the ZigPC Network]</p></li>
<li><p>Start the Unify Image Provider application. See
<a class="reference internal" href="../image_provider/readme_user.html"><span class="doc std std-doc">Unify Image Provider User Guide</span></a></p></li>
<li><p>Add the firmware image to the image-provider’s specified folder. Update the
images.json file with the firmware information.</p>
<p><em>NOTE: For this version of the Zigbee Protocol Controller, the UIID should
be set to the UNID of the node that should be updated. Future releases will
allow for a more involved UIID, which can reflect version and other
information.</em></p>
<p><em>NOTE: The image-provider’s images.json file needs to be updated <strong>after</strong>
ZigPC is running to ensure that ZigPC receives the “image announce” message.
Updating the images.json file automatically triggers this process.</em></p>
</li>
</ol>
</section>
<section id="once-the-unify-image-provider-recognizes-changes-to-images-json-the-following-actions-will-occur">
<h4>Once the Unify Image Provider recognizes changes to images.json, the following actions will occur<a class="headerlink" href="#once-the-unify-image-provider-recognizes-changes-to-images-json-the-following-actions-will-occur" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>ZigPC will recognize any supported OTA image metadata and the image should
be automatically copied to the ‘ota-files’ directory.</p></li>
<li><p>The Silicon Labs’ OTA-Client plugin on the Zigbee node should periodically
poll ZigPC for new images (based on the “OTA Client Query Delay”).</p>
<p><em>NOTE: If there is access to the CLI on the node, the command
‘<code class="docutils literal notranslate"><span class="pre">plugin</span> <span class="pre">ota-client</span> <span class="pre">request-image</span></code>’ can manually send this request to ZigPC.</em></p>
</li>
<li><p>The OTA image transfer from ZigPC to the Zigbee node should start. Do not
interrupt the OTA process to ensure proper operation. Debug messages on the
ZigPC can be enabled at startup with the option ‘-d’, which can help verify
that the messages are being sent.</p></li>
<li><p>After the OTA image upload and installation is complete, the new firmware
version running on the Zigbee node can be verified. The OTA process is now
complete.</p></li>
</ol>
</section>
</section>
<section id="retrieving-diagnostic-information-from-zigpc">
<h3>Retrieving Diagnostic information from ZigPC<a class="headerlink" href="#retrieving-diagnostic-information-from-zigpc" title="Permalink to this heading"></a></h3>
<p>ZigPC has exposed the <code class="docutils literal notranslate"><span class="pre">ProtocolController/SystemHealth</span></code> topic space to enable
the publishing of information related to the ZigPC system, process, and Zigbee stack.</p>
<p>The following metrics are available:</p>
<ul class="simple">
<li><p>Uptime: The amount of seconds the system has been online.</p></li>
<li><p>CpuLoadAverage: The system CPU load average.</p></li>
<li><p>MemUsePercent: The percent memory use of the ZigPC process.</p></li>
<li><p>Counters: The Zigbee stack counters information.</p></li>
</ul>
<section id="steps-to-enable-this-behaviour">
<h4>Steps to enable this behaviour<a class="headerlink" href="#steps-to-enable-this-behaviour" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>Retrieve the metrics supported by the protocol controller diagnostics topic space.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/SystemHealth/SupportedMetrics&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/SystemHealth/SupportedMetrics {&quot;value&quot;: [&quot;Uptime&quot;, &quot;CpuLoadAverage&quot;, &quot;MemUsePercent&quot;, &quot;Counters&quot;]}</span>
</pre></div>
</div>
</li>
<li><p>Enable a metric using the <code class="docutils literal notranslate"><span class="pre">Request</span></code> subtopic:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_pub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/SystemHealth/Request&#39;</span> -m <span class="s1">&#39;{&quot;value&quot;: [&quot;MemUsePercent&quot;]}&#39;</span>
</pre></div>
</div>
</li>
<li><p>Validate metric requested being updated regularly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## command ##</span>
RaspberryPi&gt; mosquitto_sub -h <span class="m">0</span>.0.0.0 -p <span class="m">1883</span> -t <span class="s1">&#39;ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/SystemHealth/MemUsePercent&#39;</span>

<span class="c1">## sample output ##</span>
<span class="c1"># ucl/by-unid/zb-AAAAAAAAAAAAAAAA/ProtocolController/SystemHealth/MemUsePercent {&quot;value&quot;: 0.12}</span>
</pre></div>
</div>
</li>
</ol>
<p><br><br></p>
</section>
</section>
</section>
<section id="technical-specifications">
<h2>Technical Specifications<a class="headerlink" href="#technical-specifications" title="Permalink to this heading"></a></h2>
<section id="device-unid-format">
<h3>Device UNID Format<a class="headerlink" href="#device-unid-format" title="Permalink to this heading"></a></h3>
<p>ZigPC uses the following format for the UNID: zb-<EUI64-IN-BIG-ENDIAN></p>
<p>where “zb-” is the current fixed prefix (subject to be configurable in later
releases)</p>
<p>For example, the following Zigbee device having a EUI64 of 01 23 45 67 89 AB CD EF
has the following device UNID <code class="docutils literal notranslate"><span class="pre">zb-0123456789ABCDEF</span></code>.</p>
</section>
<section id="recognized-smartstart-dsk-format">
<h3>Recognized SmartStart DSK Format<a class="headerlink" href="#recognized-smartstart-dsk-format" title="Permalink to this heading"></a></h3>
<p>ZigPC supports the following SmartStart Device-Specific Key (DSK)
format:</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;NODE_EUI64&gt;</span></code>-<code class="docutils literal notranslate"><span class="pre">&lt;Z3_INSTALL_CODE&gt;</span></code>-<code class="docutils literal notranslate"><span class="pre">&lt;Z3_INSTALL_CODE_CRC&gt;</span></code></p>
<ul class="simple">
<li><p>Both the EUI64 and Install code values should be in big endian</p></li>
<li><p>The EUI64 identifier is placed first since it has a fixed length</p></li>
<li><p>Use hyphens (“-”) to separate each group of 2 hexadecimal characters</p></li>
<li><p>This accommodates the variable Z3 Install code lengths noted above</p></li>
<li><p>The maximum length of the DSK should be 77 characters in ASCII representation
(52 characters without dashes)</p></li>
</ul>
<p>Examples of Supported ZigPC DSK:</p>
<ul class="simple">
<li><p>for <strong>8-byte</strong> Z3 Install code variant:
<code class="docutils literal notranslate"><span class="pre">00-11-22-33-44-55-66-77-AA-BB-CC-DD-EE-FF-00-11-88-99</span></code></p></li>
<li><p>for <strong>16-byte</strong> Z3 Install code variant:
<code class="docutils literal notranslate"><span class="pre">00-11-22-33-44-55-66-77-AA-BB-CC-DD-EE-FF-00-11-22-33-44-55-66-77-88-99-12-34</span></code></p></li>
</ul>
</section>
<section id="zigbee-device-support">
<h3>Zigbee Device Support<a class="headerlink" href="#zigbee-device-support" title="Permalink to this heading"></a></h3>
<p>ZigPC should have a Zigbee NCP attached via the serial UART connection.</p>
<p>EFR32MG1X or EFR32MG2X are the supported NCP Radios.</p>
<p>NCP Image supported by ZigPC from GSDK v4.1:</p>
<ul class="simple">
<li><p>ncp-uart-hw</p></li>
<li><p>ncp-uart-sw</p></li>
</ul>
<p>ZigPC currently uses the following functionality using Gecko SDK v4.0:</p>
<ul class="simple">
<li><p>Communication with Zigbee NCP using EZSP over Serial (UART)</p></li>
<li><p>Network formation as a Zigbee Trust Center</p></li>
<li><p>Device addition using Z3 Install Code Method</p></li>
<li><p>Usage of the Device Table plugin to track nodes on the PAN</p></li>
<li><p>Reporting plugin</p></li>
</ul>
<p>Device types types:</p>
<ul class="simple">
<li><p>Non Sleepy Devices (Router + End devices)</p></li>
<li><p>Sleepy End Devices</p></li>
</ul>
<p>ZCL cluster types supported by ZigPC for attribute updates and command relays:</p>
<ul class="simple">
<li><p>(0x0003) Identify</p></li>
<li><p>(0x0004) Groups</p></li>
<li><p>(0x0006) OnOff</p></li>
<li><p>(0x0008) Level</p></li>
<li><p>(0x0101) DoorLock</p></li>
<li><p>(0x0201) Thermostat</p></li>
<li><p>(0x0300) ColorControl</p></li>
<li><p>(0x0406) OccupancySensing</p></li>
</ul>
</section>
</section>
<section id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this heading"></a></h2>
<section id="setting-up-the-zigbee-ncp-connected-to-zigpc">
<h3>Setting Up the Zigbee NCP Connected to ZigPC<a class="headerlink" href="#setting-up-the-zigbee-ncp-connected-to-zigpc" title="Permalink to this heading"></a></h3>
<p>There are two ways to get the NCP image:</p>
<section id="using-pre-built-ncp-fw-images">
<h4>Using Pre-built NCP FW Images<a class="headerlink" href="#using-pre-built-ncp-fw-images" title="Permalink to this heading"></a></h4>
<p>A single radio should be designated as a Zigbee Gateway NCP that ZigPC connects
to.</p>
<p>The Gecko SDK provides ready-made NCP images available under the demo-applications package.</p>
</section>
<section id="building-ncp-fw-images-using-studio">
<h4>Building NCP FW Images Using Studio<a class="headerlink" href="#building-ncp-fw-images-using-studio" title="Permalink to this heading"></a></h4>
<p>Follow section 2 from the following application note to build a NCP application
using the Simplicity Studio IDE:
<a class="reference external" href="https://www.silabs.com/documents/public/application-notes/an1010-customized-ncp.pdf">AN1010: Building a Customized NCP Application</a></p>
</section>
</section>
<section id="setting-up-the-sample-zigbee-z3light-fw-image">
<h3>Setting Up the Sample Zigbee Z3Light FW Image<a class="headerlink" href="#setting-up-the-sample-zigbee-z3light-fw-image" title="Permalink to this heading"></a></h3>
<p>A Zigbee 3.0 Light device FW is used as an example device that can join the ZigPC network.</p>
<p>Follow the instructions in <em>Section 4: Starting an Example Application</em> in <a class="reference external" href="https://www.silabs.com/documents/public/quick-start-guides/qsg106-efr32-zigbee-pro.pdf">QSG106: Zigbee EmberZNet PRO Quick-Start Guide</a> to create a <strong>Z3Light</strong> Application.</p>
<p>NOTE: before the Appbuilder project generation, ensure the following changes are made:</p>
<ol class="arabic">
<li><p>In the <em>Plugins</em> tab, ensure the “Binding Table Size” in the “Binding Table
Library” plugin is bigger is considerable enough to accommodate ZCL groups
(uses multicast bindings) and attribute reporting (to allow ZigPC to receive
automated attribute updates). For the Z3Light project, this should be at least 16.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Plugins</span> <span class="n">tab</span> <span class="o">-&gt;</span> <span class="n">Binding</span> <span class="n">Table</span> <span class="n">Library</span> <span class="o">-&gt;</span>    <span class="n">Binding</span> <span class="n">Table</span> <span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">16</span>
</pre></div>
</div>
</li>
<li><p>[OPTIONAL] In the <em>Plugins</em> tab, ensure the “Reporting Table Size” in the
“Reporting” plugin is bigger than the number of attributes supported in each
device endpoint cluster. For the Z3Light project, this should be at least 9.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Plugins</span> <span class="n">tab</span> <span class="o">-&gt;</span> <span class="n">Reporting</span> <span class="o">-&gt;</span>    <span class="n">Reporting</span> <span class="n">Table</span> <span class="n">Size</span> <span class="o">&gt;</span> <span class="mi">9</span>
<span class="n">NOTE</span><span class="p">:</span> <span class="n">In</span> <span class="n">the</span> <span class="n">Appbuilder</span> <span class="n">project</span><span class="p">,</span> <span class="n">see</span> <span class="n">EMBER_AF_GENERATED_REPORTING_CONFIG_DEFAULTS_TABLE_SIZE</span> <span class="k">for</span> <span class="n">the</span> <span class="n">recommended</span> <span class="n">minimum</span> <span class="n">size</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p><em>NOTE: If the reporting table size is not sufficient to support all attributes, Unify IoT Services will need to use the ForceReadAttributes command to get updated attribute states</em></p>
</div></blockquote>
<p>Follow the steps below to create and flash the Zigbee Z3Light Image:</p>
</section>
<section id="flashing-zigbee-devices">
<h3>Flashing Zigbee Devices<a class="headerlink" href="#flashing-zigbee-devices" title="Permalink to this heading"></a></h3>
<p>For flashing device firmware onto the Zigbee radios, see <em>Section 4.4: Compiling and Flashing the Application</em> in <a class="reference external" href="https://www.silabs.com/documents/public/quick-start-guides/qsg106-efr32-zigbee-pro.pdf">QSG106: Zigbee EmberZNet PRO Quick-Start Guide</a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2022 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>